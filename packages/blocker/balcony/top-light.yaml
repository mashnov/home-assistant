blocker_balcony_top_light:
  input_boolean:
    blocker_balcony_top_light:

  input_number:
    blocker_balcony_top_light: 
      max: 120
      min: 1
      # 15

  timer:
    blocker_balcony_top_light:
      duration: 00:00:10
  
  template:
  - sensor:
    - name: blocker_balcony_top_light_duration
      unique_id: blocker_balcony_top_light_duration
      state: >
        {% set minutes = states('input_number.blocker_top_light_balcony') | int(0) %}
        {% set duration = minutes * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}

  automation:
  - alias: blocker_balcony_top_light_timer_start
    mode: queued
    trigger:
    - platform: state
      entity_id: input_boolean.blocker_balcony_top_light
      from: "off"
      to: "on"
    action:
    - service: timer.start
      entity_id: timer.blocker_balcony_top_light
      data:
        duration: "{{ states('sensor.blocker_balcony_top_light_duration') }}"

  - alias: blocker_balcony_top_light_timer_cancel
    mode: queued
    trigger:
    - platform: state
      entity_id: input_boolean.blocker_balcony_top_light
      from: "on"
      to: "off"
    action:
    - service: timer.cancel
      entity_id: timer.blocker_balcony_top_light

  - alias: blocker_balcony_top_light_turn_off
    mode: queued
    trigger:
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.blocker_balcony_top_light
    action:
    - service: input_boolean.turn_off
      entity_id: input_boolean.blocker_balcony_top_light
