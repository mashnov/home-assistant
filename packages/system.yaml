system:
  template:
  - binary_sensor:
    - name: 'system_is_backed_up'
      unique_id: system_is_backed_up
      state: >
        {% set nowTime = now().timestamp() - 60 %}
        {% set lastBackUp = state_attr('sensor.backup_state', 'last_backup') | as_timestamp(nowTime - 60) %}
        {{ nowTime | timestamp_custom('%H:%M') == lastBackUp | timestamp_custom('%H:%M') }}

  shell_command:
    rebuild: ha core rebuild

  script:
    system_restart:
      mode: 'queued'
      sequence:
      - service: homeassistant.restart

    system_reboot:
      mode: 'queued'
      sequence:
      - service: hassio.host_reboot

    system_rebuild:
      mode: 'queued'
      sequence:
      - service: shell_command.rebuild
