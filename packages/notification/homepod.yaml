notification_homepod:
  tts: 
  - platform: edge_tts
    service_name: edge_say
    language: ru-RU-SvetlanaNeural
    cache: false

  input_number:
    homepod_volume_night: # 40
      step: 10
      max: 100
      min: 0
    
    homepod_volume_day: # 60
      max: 100
      step: 10
      min: 0

  template:
  - sensor:
    - name: 'homepod_volume'
      unique_id: homepod_volume
      state: >
        {% set isNightMode = is_state('input_boolean.night_mode_hall', 'on') %}
        {% set nightValue = states('input_number.homepod_volume_night') | float(0) %}
        {% set dayValue = states('input_number.homepod_volume_day') | float(0) %}
        {% set value = iif(isNightMode, nightValue, dayValue) %}
        {{ value / 100 }}

  script:
    homepod_message:
      mode: 'queued'
      sequence:
      - service: media_player.volume_set
        data_template:
          entity_id: media_player.homepod
          volume_level: "{{ states('sensor.homepod_volume') }}"
      - service: tts.edge_say
        data:
          entity_id: media_player.homepod
          message: "{{ message }}"
          cache: false
