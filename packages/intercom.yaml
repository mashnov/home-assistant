intercom:
  input_boolean:
    intercom_hall:
    intercom_hall_auto_on:

  automation:
    alias: 'intercom_hall_type_detect'
    initial_state: true
    trigger: 
    - platform: state
      entity_id: switch.intercom_hall
      to: 'on'
    action:
    - choose:
      - conditions:
        - condition: template
          value_template: >
            {% set userId = trigger.to_state.context.user_id %}
            {% set parentId = trigger.to_state.context.parent_id %}
            {{ userId == none and parentId == none }}
        sequence:
        - service: script.console
          data:
            message: "type: 'call'"
      - conditions:
        - condition: template
          value_template: >
            {% set userId = trigger.to_state.context.user_id %}
            {% set parentId = trigger.to_state.context.parent_id %}
            {{ userId != none or parentId != none }}
        sequence:
        - service: script.console
          data:
            message: "type: 'open'"








# - service: switch.turn_on
#   entity_id: switch.intercom_hall
# - delay: 00:00:15
# - service: switch.turn_off
#   entity_id: switch.intercom_hall

    
# Звоню в кв:
# - авто вкл
# - ждем 3 сек
# - авто выкл

# Если включен автоответ:
# - вкл - ответ
# - выкл - открытие
