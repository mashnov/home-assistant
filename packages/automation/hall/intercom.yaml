automation_hall_intercom:
  automation:
  - alias: automation_hall_intercom_call
    trigger: 
    - platform: state
      entity_id: switch.intercom_hall
      from: "on"
      to: "off"
    condition:
    - condition: template
      value_template: >
        {% set userId = trigger.to_state.context.user_id %}
        {% set parentId = trigger.to_state.context.parent_id %}
        {{ userId == none and parentId == none }}
    action:
    - service: script.console
      data:
        message: "Вызов вкл"
    - service: input_boolean.turn_on
      entity_id: input_boolean.intercom_hall_call
    - delay: 00:00:05
    - service: script.console
      data:
        message: "Вызов выкл"
    - service: input_boolean.turn_off
      entity_id: input_boolean.intercom_hall_call

  - alias: automation_hall_intercom_auto_open
    trigger: 
    - platform: state
      entity_id: input_boolean.intercom_hall_call
      from: "on"
      to: "off"
    condition:
    - condition: state
      entity_id: input_boolean.intercom_hall_enabled
      state: "off"
    action:
    - delay: 00:00:02
    - service: lock.unlock
      entity_id: lock.hall_intercom

