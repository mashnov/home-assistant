automation_hall_intercom:
  automation:
  - alias: automation_hall_intercom_call
    trigger: 
    - platform: state
      entity_id: switch.intercom_hall
      from: "off"
      to: "on"
    condition:
    - condition: state
      entity_id: input_boolean.intercom_hall_call
      state: "off"
    action:
    - service: input_boolean.turn_on
      entity_id: input_boolean.intercom_hall_call
    - delay: 00:00:10
    - service: input_boolean.turn_off
      entity_id: input_boolean.intercom_hall_call

  - alias: automation_hall_intercom_auto_open
    trigger: 
    - platform: state
      entity_id: input_boolean.intercom_hall_call
      from: "off"
      to: "on"
    condition:
    - condition: state
      entity_id: input_boolean.intercom_hall_enabled
      state: "on"
    action:
    - delay: 00:00:03
    - service: lock.unlock
      entity_id: lock.intercom_hall
    - delay: 00:00:01
    - service: lock.unlock
      entity_id: lock.intercom_hall

    # - condition: template
    #   value_template: >
    #     {% set userId = trigger.to_state.context.user_id %}
    #     {% set parentId = trigger.to_state.context.parent_id %}
    #     {{ userId == none and parentId == none }}
