automation_bedroom_cover:
  input_number:
    automation_bedroom_cover_step: 
      max: 60
      min: 0
      # 4

    automation_bedroom_cover_day: 
      max: 100
      min: 0
      # 5

    automation_bedroom_cover_night: 
      max: 100
      min: 0
      # 55

  automation:
  - alias: automation_bedroom_cover_day
    mode: queued
    trigger:
    - platform: state
      entity_id: input_boolean.is_night_mode
      from: "on"
      to: "off"
    action:
    - service: cover.set_cover_position
      entity_id: cover.curtain_bedroom
      data_template:
        position: "{{ states('input_number.automation_bedroom_cover_day') | int(0) }}"

  - alias: automation_bedroom_cover_night
    mode: queued
    trigger:
    - platform: state
      entity_id: input_boolean.is_night_mode
      from: "off"
      to: "on"
    action:
    - service: cover.set_cover_position
      entity_id: cover.curtain_bedroom
      data_template:
        position: "{{ states('input_number.automation_bedroom_cover_night') | int(0) }}"

  - alias: automation_bedroom_cover_controll_right
    mode: queued
    trigger:
    - platform: state
      entity_id: sensor.cube_bedroom_action
      to: "rotate_right"
    action:
    - service: cover.set_cover_position
      entity_id: cover.curtain_bedroom
      data_template:
        position: >
          {% set step = states('input_number.automation_bedroom_cover_step') | int(0) %}
          {% set position = state_attr('cover.curtain_bedroom', 'position') | int(0) + step %}
          {{ [[0 , position] | max, [100, position] | min] | min }}

  - alias: automation_bedroom_cover_controll_left
    mode: queued
    trigger:
    - platform: state
      entity_id: sensor.cube_bedroom_action
      to: "rotate_left"
    action:
    - service: cover.set_cover_position
      entity_id: cover.curtain_bedroom
      data_template:
        position: >
          {% set step = states('input_number.automation_bedroom_cover_step') | int(0) %}
          {% set position = state_attr('cover.curtain_bedroom', 'position') | int(0) - step %}
          {{ [[0 , position] | max, [100, position] | min] | min }}
