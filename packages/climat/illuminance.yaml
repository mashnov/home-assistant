climat_illuminance:
  sensor:
  - platform: statistics
    name: climat_illuminance_max
    unique_id: climat_illuminance_max
    entity_id: sensor.climat_illuminance_average
    state_characteristic: value_max
    max_age:
      days: 1

  - platform: statistics
    name: climat_illuminance_average
    unique_id: climat_illuminance_average
    entity_id: sensor.climat_illuminance_virtual
    state_characteristic: average
    max_age:
      minutes: 10

  template:
  - sensor:
    - name: climat_illuminance_maximum
      unique_id: climat_illuminance_maximum
      device_class: illuminance
      unit_of_measurement: lx
      state: "{{ [states('sensor.climat_illuminance_max') | int, 4000] | max }}"

    - name: climat_illuminance_virtual
      unique_id: climat_illuminance_virtual
      device_class: illuminance
      unit_of_measurement: lx
      state: "{{ states('sensor.illuminance_balcony') | round(1, default = 0) | float }}"