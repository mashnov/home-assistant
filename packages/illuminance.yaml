illuminance:
  input_number:
    min_illuminance_kitchen_top_light: # 3000
      initial: 3000
      max: 8000
      min: 1

    min_illuminance_kitchen_curtain: # 3000
      initial: 3000
      max: 8000
      min: 1
    
    min_illuminance_bedroom_back_ligh: # 6000
      initial: 6000
      max: 8000
      min: 1
    
    min_illuminance_living_back_ligh: # 6000
      initial: 6000
      max: 8000
      min: 1
    
    min_illuminance_living_curtain: # 3000
      initial: 3000
      max: 8000
      min: 1

  sensor:
  - name: illuminance_balcony_max
    unique_id: illuminance_balcony_max
    platform: statistics
    entity_id: sensor.illuminance_balcony_virtual
    state_characteristic: value_max
    max_age:
      hours: 6

  - name: illuminance_balcony_average
    unique_id: illuminance_balcony_average
    platform: statistics
    entity_id: sensor.illuminance_balcony_virtual
    state_characteristic: average_timeless
    max_age:
      minutes: 1 

  template:
  - sensor:
    - name: 'illuminance_balcony_virtual'
      unique_id: illuminance_balcony_virtual
      unit_of_measurement: "lx"
      state: "{{ states('sensor.illuminance_balcony') | float(0) | round(1) }}"

  - binary_sensor:
    - name: 'kitchen_top_light_is_dark'
      unique_id: kitchen_top_light_is_dark
      delay_off: '00:00:15'
      state: >
        {% set sensor = states('sensor.illuminance_balcony_average') | int(0) %}
        {% set minValue = states('input_number.min_illuminance_kitchen_top_light') | int(0) %}
        {{ sensor < minValue }}
    
    - name: 'kitchen_curtain_is_dark'
      unique_id: kitchen_curtain_is_dark
      delay_off: '00:00:15'
      state: >
        {% set sensor = states('sensor.illuminance_balcony_average') | int(0) %}
        {% set minValue = states('input_number.min_illuminance_kitchen_curtain') | int(0) %}
        {{ sensor < minValue }}
    
    - name: 'bedroom_back_ligh_is_dark'
      unique_id: bedroom_back_ligh_is_dark
      delay_off: '00:00:15'
      state: >
        {% set sensor = states('sensor.illuminance_balcony_average') | int(0) %}
        {% set minValue = states('input_number.min_illuminance_bedroom_back_ligh') | int(0) %}
        {{ sensor < minValue }}
    
    - name: 'living_back_lighis_dark'
      unique_id: living_back_lighis_dark
      delay_off: '00:00:15'
      state: >
        {% set sensor = states('sensor.illuminance_balcony_average') | int(0) %}
        {% set minValue = states('input_number.min_illuminance_living_back_ligh') | int(0) %}
        {{ sensor < minValue }}
    
    - name: 'living_curtain_is_dark'
      unique_id: living_curtain_is_dark
      delay_off: '00:00:15'
      state: >
        {% set sensor = states('sensor.illuminance_balcony_average') | int(0) %}
        {% set minValue = states('input_number.min_illuminance_living_curtain') | int(0) %}
        {{ sensor < minValue }}
