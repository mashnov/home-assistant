night_mode_hall:
  input_datetime:
    night_mode_hall_on:
      has_date: false
      has_time: true
       # 01:00:00
    
    night_mode_hall_off:
      has_date: false
      has_time: true
      # 10:30:00

  input_boolean:
    night_mode_hall:

  input_select:
    home_mode:
      options:
      - morning
      - day
      - evening
      - night

  template:
  - binary_sensor:
    - name: night_mode_hall
      unique_id: night_mode_hall
      state: >
        {% set current = now().time() %}
        {% set from_time = strptime(states('input_datetime.night_mode_hall_on'), "%H:%M:%S").time() %}
        {% set till_time = strptime(states('input_datetime.night_mode_hall_off'), "%H:%M:%S").time() %}
        {% if from_time > till_time %}
          {{ (from_time <= current) or (current <= till_time) }}
        {% else %}
          {{ (from_time <= current) and (current <= till_time) }}
        {% endif %}

    - name: night_mode_hall_on_time
      unique_id: night_mode_hall_on_time
      state: >
        {% set current = now().time() %}
        {% set till = strptime(states('input_datetime.night_mode_hall_on'), "%H:%M:%S") %}
        {% set from_time = (till - timedelta(minutes = 30)).time() %}
        {% set till_time = till.time() %}
        {% if from_time > till_time %}
          {{ (from_time <= current) or (current <= till_time) }}
        {% else %}
          {{ (from_time <= current) and (current <= till_time) }}
        {% endif %}

    - name: night_mode_hall_off_time
      unique_id: night_mode_hall_off_time
      state: >
        {% set current = now().time() %}
        {% set till = strptime(states('input_datetime.night_mode_hall_off'), "%H:%M:%S") %}
        {% set from_time = (till - timedelta(minutes = 60)).time() %}
        {% set till_time = till.time() %}
        {% if from_time > till_time %}
          {{ (from_time <= current) or (current <= till_time) }}
        {% else %}
          {{ (from_time <= current) and (current <= till_time) }}
        {% endif %}
