blocker:
  input_boolean:
    blocker_top_light_kitchen:
    blocker_top_light_hall:
    blocker_top_light_bath:
    blocker_top_light_bedroom:
    blocker_top_light_living:
    blocker_back_light_kitchen:
    blocker_top_light_balcony:
    blocker_night_light_bath:
    blocker_back_light_balcony:
    blocker_fan_toilet:
    blocker_balcony_sprinkler:
    blocker_balcony_socket:

  input_number:
    blocker_top_light_kitchen: # 01:00:00
      max: 120
      min: 1
    blocker_top_light_bath: # 01:00:00
      max: 120
      min: 1
    blocker_top_light_hall: # 01:00:00
      max: 120
      min: 1
    blocker_top_light_bedroom: # 01:00:00
      max: 120
      min: 1
    blocker_top_light_living: # 01:00:00
      max: 120
      min: 1
    blocker_back_light_kitchen: # 01:00:00
      max: 120
      min: 1
    blocker_top_light_balcony: # 01:00:00
      max: 120
      min: 1
    blocker_night_light_bath: # 01:00:00
      max: 120
      min: 1
    blocker_back_light_balcony: # 00:10:00
      max: 120
      min: 1
    blocker_fan_toilet: # 00:10:00
      max: 120
      min: 1
    blocker_balcony_sprinkler: # 00:10:00
      max: 120
      min: 1
    blocker_balcony_socket: # 01:00:00
      max: 120
      min: 1

  timer:
    blocker_top_light_kitchen:
      duration: '00:00:10'
    blocker_top_light_bath:
      duration: '00:00:10'
    blocker_top_light_hall:
      duration: '00:00:10'
    blocker_top_light_bedroom:
      duration: '00:00:10'
    blocker_top_light_living:
      duration: '00:00:10'
    blocker_back_light_kitchen:
      duration: '00:00:10'
    blocker_top_light_balcony:
      duration: '00:00:10'
    blocker_night_light_bath:
      duration: '00:00:10'
    blocker_back_light_balcony:
      duration: '00:00:10'
    blocker_fan_toilet:
      duration: '00:00:10'
    blocker_balcony_sprinkler:
      duration: '00:00:10'
    blocker_balcony_socket:
      duration: '00:00:10'
  
  template:
  - sensor:
    - name: 'blocker_top_light_kitchen'
      unique_id: blocker_top_light_kitchen
      state: >
        {% set minutes = states('input_number.blocker_top_light_kitchen') | int(0) %}
        {% set duration = minutes * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}

    - name: 'blocker_top_light_bath'
      unique_id: blocker_top_light_bath
      state: >
        {% set minutes = states('input_number.blocker_top_light_bath') | int(0) %}
        {% set duration = minutes * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}

    - name: 'blocker_top_light_hall'
      unique_id: blocker_top_light_hall
      state: >
        {% set minutes = states('input_number.blocker_top_light_hall') | int(0) %}
        {% set duration = minutes * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}

    - name: 'blocker_top_light_bedroom'
      unique_id: blocker_top_light_bedroom
      state: >
        {% set minutes = states('input_number.blocker_top_light_bedroom') | int(0) %}
        {% set duration = minutes * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}

    - name: 'blocker_top_light_living'
      unique_id: blocker_top_light_living
      state: >
        {% set minutes = states('input_number.blocker_top_light_living') | int(0) %}
        {% set duration = minutes * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}

    - name: 'blocker_back_light_kitchen'
      unique_id: blocker_back_light_kitchen
      state: >
        {% set minutes = states('input_number.blocker_back_light_kitchen') | int(0) %}
        {% set duration = minutes * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}

    - name: 'blocker_top_light_balcony'
      unique_id: blocker_top_light_balcony
      state: >
        {% set minutes = states('input_number.blocker_top_light_balcony') | int(0) %}
        {% set duration = minutes * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}

    - name: 'blocker_night_light_bath'
      unique_id: blocker_night_light_bath
      state: >
        {% set minutes = states('input_number.blocker_night_light_bath') | int(0) %}
        {% set duration = minutes * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}

    - name: 'blocker_back_light_balcony'
      unique_id: blocker_back_light_balcony
      state: >
        {% set minutes = states('input_number.blocker_back_light_balcony') | int(0) %}
        {% set duration = minutes * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}

    - name: 'blocker_fan_toilet'
      unique_id: blocker_fan_toilet
      state: >
        {% set minutes = states('input_number.blocker_fan_toilet') | int(0) %}
        {% set duration = minutes * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}

    - name: 'blocker_balcony_sprinkler'
      unique_id: blocker_balcony_sprinkler
      state: >
        {% set minutes = states('input_number.blocker_balcony_sprinkler') | int(0) %}
        {% set duration = minutes * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}

    - name: 'blocker_balcony_socket'
      unique_id: blocker_balcony_socket
      state: >
        {% set minutes = states('input_number.blocker_balcony_socket') | int(0) %}
        {% set duration = minutes * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}

  automation:
  ### KITCHEN TOP LIGHT
  - alias: 'blocker_top_light_kitchen_boolean'
    mode: 'queued'
    trigger:
    - id: 'boolean_toggle'
      platform: state
      entity_id: sensor.kitchen_switch_action
      to: 'single_right'
    - id: 'boolean_off'
      platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.blocker_top_light_kitchen
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'boolean_toggle'
        sequence:
        - service: input_boolean.toggle
          entity_id: input_boolean.blocker_top_light_kitchen
      - conditions:
        - condition: trigger
          id: 'boolean_off'
        sequence:
        - service: input_boolean.turn_off
          entity_id: input_boolean.blocker_top_light_kitchen

  - alias: 'blocker_top_light_kitchen_timer'
    mode: 'queued'
    trigger:
    - id: 'timer_on'
      platform: state
      entity_id: 'input_boolean.blocker_top_light_kitchen'
      from: 'off'
      to: 'on'
    - id: 'timer_off'
      platform: state
      entity_id: 'input_boolean.blocker_top_light_kitchen'
      from: 'on'
      to: 'off'
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'timer_on'
        sequence:
        - service: timer.start
          entity_id: timer.blocker_top_light_kitchen
          data:
            duration: "{{ states('sensor.blocker_top_light_kitchen') }}"
      - conditions:
        - condition: trigger
          id: 'timer_off'
        sequence:
        - service: timer.cancel
          entity_id: timer.blocker_top_light_kitchen

  ### KITCHEN BACK LIGHT
  - alias: 'blocker_back_light_kitchen_boolean'
    mode: 'queued'
    trigger:
    - id: 'boolean_toggle'
      platform: state
      entity_id: sensor.kitchen_switch_action
      to: 'single_left'
    - id: 'boolean_off'
      platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.blocker_back_light_kitchen
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'boolean_toggle'
        sequence:
        - service: input_boolean.toggle
          entity_id: input_boolean.blocker_back_light_kitchen
      - conditions:
        - condition: trigger
          id: 'boolean_off'
        sequence:
        - service: input_boolean.turn_off
          entity_id: input_boolean.blocker_back_light_kitchen

  - alias: 'blocker_back_light_kitchen_timer'
    mode: 'queued'
    trigger:
    - id: 'timer_on'
      platform: state
      entity_id: 'input_boolean.blocker_back_light_kitchen'
      from: 'off'
      to: 'on'
    - id: 'timer_off'
      platform: state
      entity_id: 'input_boolean.blocker_back_light_kitchen'
      from: 'on'
      to: 'off'
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'timer_on'
        sequence:
        - service: timer.start
          entity_id: timer.blocker_back_light_kitchen
      - conditions:
        - condition: trigger
          id: 'timer_off'
        sequence:
        - service: timer.cancel
          entity_id: timer.blocker_back_light_kitchen

  ### BATH LIGHT
  - alias: 'blocker_top_light_bath_boolean'
    mode: 'queued'
    trigger:
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.blocker_top_light_bath
    action:
    - service: input_boolean.turn_off
      entity_id: input_boolean.blocker_top_light_bath

  - alias: 'blocker_night_light_bath_boolean'
    mode: 'queued'
    trigger:
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.blocker_night_light_bath
    action:
    - service: input_boolean.turn_off
      entity_id: input_boolean.blocker_night_light_bath

  - alias: 'blocker_top_light_bath_timer'
    mode: 'queued'
    trigger:
    - id: 'timer_on'
      platform: state
      entity_id: 'input_boolean.blocker_top_light_bath'
      from: 'off'
      to: 'on'
    - id: 'timer_off'
      platform: state
      entity_id: 'input_boolean.blocker_top_light_bath'
      from: 'on'
      to: 'off'
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'timer_on'
        sequence:
        - service: timer.start
          entity_id: timer.blocker_top_light_bath
      - conditions:
        - condition: trigger
          id: 'timer_off'
        sequence:
        - service: timer.cancel
          entity_id: timer.blocker_top_light_bath

  - alias: 'blocker_night_light_bath_timer'
    mode: 'queued'
    trigger:
    - id: 'timer_on'
      platform: state
      entity_id: 'input_boolean.blocker_night_light_bath'
      from: 'off'
      to: 'on'
    - id: 'timer_off'
      platform: state
      entity_id: 'input_boolean.blocker_night_light_bath'
      from: 'on'
      to: 'off'
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'timer_on'
        sequence:
        - service: timer.start
          entity_id: timer.blocker_night_light_bath
      - conditions:
        - condition: trigger
          id: 'timer_off'
        sequence:
        - service: timer.cancel
          entity_id: timer.blocker_night_light_bath

  - alias: 'blocker_light_bath'
    mode: 'queued'
    trigger:
    - platform: state
      entity_id: sensor.restroom_switch_action
      to: 'single_left'
    action:
    - choose:
      - conditions:
        - condition: template
          value_template: >
            {% set isNightLightBlocker = is_state("input_boolean.blocker_night_light_bath", "on") %}
            {% set isTopLightBlocker = is_state("input_boolean.blocker_top_light_bath", "on") %}
            {{ isNightLightBlocker or isTopLightBlocker }}
        sequence:
        - parallel:
          - service: input_boolean.turn_off
            entity_id: input_boolean.blocker_night_light_bath
          - service: input_boolean.turn_off
            entity_id: input_boolean.blocker_top_light_bath      
      - conditions:
        - condition: state
          entity_id: input_boolean.blocker_night_light_bath
          state: 'off'
        sequence:
        - parallel:
          - service: input_boolean.turn_on
            entity_id: input_boolean.blocker_night_light_bath
          - service: input_boolean.turn_on
            entity_id: input_boolean.blocker_top_light_bath

  ### HALL TOP LIGHT
  - alias: 'blocker_top_light_hall_boolean'
    mode: 'queued'
    trigger:
    - id: 'boolean_toggle'
      platform: state
      entity_id: sensor.hall_switch_action
      to: 'single'
    - id: 'boolean_off'
      platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.blocker_top_light_hall
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'boolean_toggle'
        sequence:
        - service: input_boolean.toggle
          entity_id: input_boolean.blocker_top_light_hall
      - conditions:
        - condition: trigger
          id: 'boolean_off'
        sequence:
        - service: input_boolean.turn_off
          entity_id: input_boolean.blocker_top_light_hall

  - alias: 'blocker_top_light_hall_timer'
    mode: 'queued'
    trigger:
    - id: 'timer_on'
      platform: state
      entity_id: 'input_boolean.blocker_top_light_hall'
      from: 'off'
      to: 'on'
    - id: 'timer_off'
      platform: state
      entity_id: 'input_boolean.blocker_top_light_hall'
      from: 'on'
      to: 'off'
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'timer_on'
        sequence:
        - service: timer.start
          entity_id: timer.blocker_top_light_hall
      - conditions:
        - condition: trigger
          id: 'timer_off'
        sequence:
        - service: timer.cancel
          entity_id: timer.blocker_top_light_hall

  ### BEDROOM TOP LIGHT
  - alias: 'blocker_top_light_bedroom_boolean'
    mode: 'queued'
    trigger:
    - id: 'boolean_toggle'
      platform: state
      entity_id: sensor.bedroom_switch_action
      to: 'single'
    - id: 'boolean_off'
      platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.blocker_top_light_bedroom
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'boolean_toggle'
        sequence:
        - service: input_boolean.toggle
          entity_id: input_boolean.blocker_top_light_bedroom
      - conditions:
        - condition: trigger
          id: 'boolean_off'
        sequence:
        - service: input_boolean.turn_off
          entity_id: input_boolean.blocker_top_light_bedroom

  - alias: 'blocker_top_light_bedroom_timer'
    mode: 'queued'
    trigger:
    - id: 'timer_on'
      platform: state
      entity_id: 'input_boolean.blocker_top_light_bedroom'
      from: 'off'
      to: 'on'
    - id: 'timer_off'
      platform: state
      entity_id: 'input_boolean.blocker_top_light_bedroom'
      from: 'on'
      to: 'off'
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'timer_on'
        sequence:
        - service: timer.start
          entity_id: timer.blocker_top_light_bedroom
      - conditions:
        - condition: trigger
          id: 'timer_off'
        sequence:
        - service: timer.cancel
          entity_id: timer.blocker_top_light_bedroom

  ### LIVING TOP LIGHT
  - alias: 'blocker_top_light_living_boolean'
    mode: 'queued'
    trigger:
    - id: 'boolean_toggle'
      platform: state
      entity_id: sensor.living_switch_action
      to: 'single'
    - id: 'boolean_off'
      platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.blocker_top_light_living
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'boolean_toggle'
        sequence:
        - service: input_boolean.toggle
          entity_id: input_boolean.blocker_top_light_living
      - conditions:
        - condition: trigger
          id: 'boolean_off'
        sequence:
        - service: input_boolean.turn_off
          entity_id: input_boolean.blocker_top_light_living

  - alias: 'blocker_top_light_living_timer'
    mode: 'queued'
    trigger:
    - id: 'timer_on'
      platform: state
      entity_id: 'input_boolean.blocker_top_light_living'
      from: 'off'
      to: 'on'
    - id: 'timer_off'
      platform: state
      entity_id: 'input_boolean.blocker_top_light_living'
      from: 'on'
      to: 'off'
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'timer_on'
        sequence:
        - service: timer.start
          entity_id: timer.blocker_top_light_living
      - conditions:
        - condition: trigger
          id: 'timer_off'
        sequence:
        - service: timer.cancel
          entity_id: timer.blocker_top_light_living
  
  ### BALCONY TOP LIGHT
  - alias: 'blocker_top_light_balcony_boolean'
    mode: 'queued'
    trigger:
    - id: 'boolean_toggle'
      platform: state
      entity_id: sensor.balcony_button_action
      to: 'single'
    - id: 'boolean_off'
      platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.blocker_top_light_balcony
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'boolean_toggle'
        sequence:
        - service: input_boolean.toggle
          entity_id: input_boolean.blocker_top_light_balcony
      - conditions:
        - condition: trigger
          id: 'boolean_off'
        sequence:
        - service: input_boolean.turn_off
          entity_id: input_boolean.blocker_top_light_balcony    
    
  - alias: 'blocker_top_light_balcony_timer'
    mode: 'queued'
    trigger:
    - id: 'timer_on'
      platform: state
      entity_id: 'input_boolean.blocker_top_light_balcony'
      from: 'off'
      to: 'on'
    - id: 'timer_off'
      platform: state
      entity_id: 'input_boolean.blocker_top_light_balcony'
      from: 'on'
      to: 'off'
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'timer_on'
        sequence:
        - service: timer.start
          entity_id: timer.blocker_top_light_balcony
      - conditions:
        - condition: trigger
          id: 'timer_off'
        sequence:
        - service: timer.cancel
          entity_id: timer.blocker_top_light_balcony

  ### BALCONY BACK LIGHT
  - alias: 'blocker_back_light_balcony_boolean'
    mode: 'queued'
    trigger:
    - id: 'boolean_toggle'
      platform: state
      entity_id: sensor.balcony_button_action
      to: 'double'
    - id: 'boolean_off'
      platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.blocker_back_light_balcony
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'boolean_toggle'
        sequence:
        - service: input_boolean.toggle
          entity_id: input_boolean.blocker_back_light_balcony
      - conditions:
        - condition: trigger
          id: 'boolean_off'
        sequence:
        - service: input_boolean.turn_off
          entity_id: input_boolean.blocker_back_light_balcony

  - alias: 'blocker_back_light_balcony_timer'
    mode: 'queued'
    trigger:
    - id: 'timer_on'
      platform: state
      entity_id: 'input_boolean.blocker_back_light_balcony'
      from: 'off'
      to: 'on'
    - id: 'timer_off'
      platform: state
      entity_id: 'input_boolean.blocker_back_light_balcony'
      from: 'on'
      to: 'off'
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'timer_on'
        sequence:
        - service: timer.start
          entity_id: timer.blocker_back_light_balcony
      - conditions:
        - condition: trigger
          id: 'timer_off'
        sequence:
        - service: timer.cancel
          entity_id: timer.blocker_back_light_balcony

  ### TOILET FAN
  - alias: 'blocker_fan_toilet_boolean'
    mode: 'queued'
    trigger:
    - id: 'boolean_off'
      platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.blocker_fan_toilet
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'boolean_off'
        sequence:
        - service: input_boolean.turn_off
          entity_id: input_boolean.blocker_fan_toilet

  - alias: 'blocker_fan_toilet_timer'
    mode: 'queued'
    trigger:
    - id: 'timer_on'
      platform: state
      entity_id: 'input_boolean.blocker_fan_toilet'
      from: 'off'
      to: 'on'
    - id: 'timer_off'
      platform: state
      entity_id: 'input_boolean.blocker_fan_toilet'
      from: 'on'
      to: 'off'
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'timer_on'
        sequence:
        - service: timer.start
          entity_id: timer.blocker_fan_toilet
      - conditions:
        - condition: trigger
          id: 'timer_off'
        sequence:
        - service: timer.cancel
          entity_id: timer.blocker_fan_toilet

  ### BALCONY SOCKET
  - alias: 'blocker_balcony_socket_boolean'
    mode: 'queued'
    trigger:
    - id: 'boolean_toggle'
      platform: state
      entity_id: sensor.balcony_button_action
      to: 'hold'
    - id: 'boolean_off'
      platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.blocker_balcony_socket
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'boolean_toggle'
        sequence:
        - service: input_boolean.toggle
          entity_id: input_boolean.blocker_balcony_socket
      - conditions:
        - condition: trigger
          id: 'boolean_off'
        sequence:
        - service: input_boolean.turn_off
          entity_id: input_boolean.blocker_balcony_socket

  - alias: 'blocker_balcony_socket_timer'
    mode: 'queued'
    trigger:
    - id: 'timer_on'
      platform: state
      entity_id: 'input_boolean.blocker_balcony_socket'
      from: 'off'
      to: 'on'
    - id: 'timer_off'
      platform: state
      entity_id: 'input_boolean.blocker_balcony_socket'
      from: 'on'
      to: 'off'
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'timer_on'
        sequence:
        - service: timer.start
          entity_id: timer.blocker_balcony_socket
      - conditions:
        - condition: trigger
          id: 'timer_off'
        sequence:
        - service: timer.cancel
          entity_id: timer.blocker_balcony_socket

  ### BALCONY SPRINKLER
  - alias: 'blocker_balcony_sprinkler_boolean'
    mode: 'queued'
    trigger:
    - id: 'boolean_toggle'
      platform: state
      entity_id: sensor.balcony_button_action
      to: 'shake'
    - id: 'boolean_off'
      platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.blocker_balcony_sprinkler
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'boolean_toggle'
        sequence:
        - service: input_boolean.toggle
          entity_id: input_boolean.blocker_balcony_sprinkler
      - conditions:
        - condition: trigger
          id: 'boolean_off'
        sequence:
        - service: input_boolean.turn_off
          entity_id: input_boolean.blocker_balcony_sprinkler

  - alias: 'blocker_balcony_sprinkler_timer'
    mode: 'queued'
    trigger:
    - id: 'timer_on'
      platform: state
      entity_id: 'input_boolean.blocker_balcony_sprinkler'
      from: 'off'
      to: 'on'
    - id: 'timer_off'
      platform: state
      entity_id: 'input_boolean.blocker_balcony_sprinkler'
      from: 'on'
      to: 'off'
    action:
    - choose:
      - conditions:
        - condition: trigger
          id: 'timer_on'
        sequence:
        - service: timer.start
          entity_id: timer.blocker_balcony_sprinkler
      - conditions:
        - condition: trigger
          id: 'timer_off'
        sequence:
        - service: timer.cancel
          entity_id: timer.blocker_balcony_sprinkler
