system:
  shell_command:
    system_rebuild: ha core rebuild
    system_clear_data: cd /config/ && rm home-assistant_v2.db-wal home-assistant_v2.db-shm home-assistant_v2.db home-assistant.log.fault home-assistant.log.1 home-assistant.log
    system_pull: cd /config/includes/ && git pull

  template:
  - sensor:
    - name: system_temperature_virtual
      unique_id: system_temperature_virtual
      device_class: temperature
      unit_of_measurement: Â°C
      state: "{{ states('sensor.processor_temperature') | int(1) }}"

  - binary_sensor:
    - name: 'system_is_backed_up'
      unique_id: system_is_backed_up
      state: >
        {% set nowTime = now().timestamp() - 60 %}
        {% set lastBackUp = state_attr('sensor.backup_state', 'last_backup') | as_timestamp(nowTime - 60) %}
        {{ nowTime | timestamp_custom('%H:%M') == lastBackUp | timestamp_custom('%H:%M') }}
  
  script:
    system_restart:
      mode: 'queued'
      sequence:
      - service: homeassistant.restart

    system_reboot:
      mode: 'queued'
      sequence:
      - service: hassio.host_reboot

    system_rebuild:
      mode: 'queued'
      sequence:
      - service: shell_command.system_rebuild
