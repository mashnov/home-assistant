system:
  shell_command:
    system_rebuild: ha core rebuild

  binary_sensor:
  - platform: trend
    sensors:
      sustem_temperature_is_decreasing:
        entity_id: sensor.sustem_temperature_virtual
        sample_duration: 3600
        invert: true

  template:
  - sensor:
    - name: sustem_temperature_virtual
      unique_id: sustem_temperature_virtual
      device_class: temperature
      unit_of_measurement: Â°C
      state: "{{ states('sensor.processor_temperature') | round(1, default = 0) | float }}"

  - binary_sensor:
    - name: 'system_is_backed_up'
      unique_id: system_is_backed_up
      state: >
        {% set nowTime = now().timestamp() - 60 %}
        {% set lastBackUp = state_attr('sensor.backup_state', 'last_backup') | as_timestamp(nowTime - 60) %}
        {{ nowTime | timestamp_custom('%H:%M') == lastBackUp | timestamp_custom('%H:%M') }}
  
  script:
    system_restart:
      mode: 'queued'
      sequence:
      - service: homeassistant.restart

    system_reboot:
      mode: 'queued'
      sequence:
      - service: hassio.host_reboot

    system_rebuild:
      mode: 'queued'
      sequence:
      - service: shell_command.system_rebuild
