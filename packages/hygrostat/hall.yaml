hygrostat_hall:
  generic_hygrostat:
  - name: hygrostat_hall
    device_class: humidifier
    humidifier: switch.relay_hall_l2
    target_sensor: sensor.humidity_hall_virtual

  input_number:
    hygrostat_hall_power_offset: 
      max: 60
      min: 0
      # 12
    
  template:
  - binary_sensor:
    - name: hygrostat_hall_is_empty
      unique_id: hygrostat_hall_is_empty
      device_class: moisture
      delay_on: 00:00:05
      state: >
        {% set humidifier = is_state('switch.relay_hall_l2', 'on') %}
        {% set backlight = is_state('light.back_light_hall', 'on') %}
        {% set offset = states('input_number.hygrostat_hall_power_offset') | int(0) %}
        {% set power = states('sensor.relay_hall_power') | float(0) | round(0) %}
        {% set sensor = iif(backlight, power - offset, power) %}
        {{ humidifier and (sensor <= 0) }}
