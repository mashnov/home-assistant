occupancy_kicthen:
  input_boolean:
    occupancy_kitchen: 
   
  input_number:
    occupancy_kitchen_day:
      step: 0.5
      max: 10
      min: 1
      # 4.5

    occupancy_kitchen_night: 
      step: 0.5
      max: 10
      min: 0
      # 1.5

  template:
  - binary_sensor:
    - name: occupancy_kitchen_virtual
      unique_id: occupancy_kitchen_virtual
      device_class: motion
      state: "{{ is_state('binary_sensor.kitchen_motion_occupancy', 'on') }}"
      delay_off: > 
        {% set sensor = states('sensor.occupancy_kitchen_duration') %}
        {% set duration = iif(sensor not in ['unknown', 'unavailable'], sensor, '00:01:30') %}
        {{ duration }}

    - name: occupancy_kitchen
      unique_id: occupancy_kitchen
      device_class: occupancy
      state: >
        {% set sensor = is_state('binary_sensor.occupancy_kitchen_virtual', 'on') %}
        {% set boolean = is_state('input_boolean.occupancy_kitchen', 'on') %}
        {{ sensor or boolean }}

  - sensor:
    - name: occupancy_kitchen_duration
      unique_id: occupancy_kitchen_duration
      state: >
        {% set isNightMode = is_state('input_boolean.night_mode_hall', 'on') %}
        {% set nightValue = states('input_number.occupancy_kitchen_day') | float(0) %}
        {% set dayValue = states('input_number.occupancy_kitchen_day') | float(0) %}
        {% set value = iif(isNightMode, nightValue, dayValue) %}
        {% set duration = value * 60 %}
        {{ duration | timestamp_custom('%H:%M:%S', false) }}
