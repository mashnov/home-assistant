sun:
  input_number:
    # kitchen
    sun_kitchen_cloud_level_min:
      max: 100
      min: 0
      step: 1
    sun_kitchen_sensor_delay_on:
      max: 120
      min: 0
      step: 1
    sun_kitchen_sensor_delay_off:
      max: 120
      min: 0
      step: 1
    sun_kitchen_curtain_sunni_min:
      max: 9000
      min: 0
      step: 10
    sun_kitchen_curtain_cloudly_min:
      max: 9000
      min: 0
      step: 10
    sun_kitchen_backlight_sunni_max:
      max: 9000
      min: 0
      step: 10
    sun_kitchen_backlight_cloudly_max:
      max: 9000
      min: 0
      step: 10
    sun_kitchen_toplight_sunni_max:
      max: 9000
      min: 0
      step: 10
    sun_kitchen_toplight_cloudly_max:
      max: 9000
      min: 0
      step: 10
    # hall
    sun_hall_sensor_delay_on:
      max: 120
      min: 0
      step: 1
    sun_hall_sensor_delay_off:
      max: 120
      min: 0
      step: 1
    sun_hall_backlight_max:
      max: 20000
      min: 0
      step: 10
    sun_hall_toplight_max:
      max: 9000
      min: 0
      step: 10
    # bedroom
    sun_bedroom_cloud_level_min:
      max: 100
      min: 0
      step: 1
    sun_bedroom_sensor_delay_on:
      max: 120
      min: 0
      step: 1
    sun_bedroom_sensor_delay_off:
      max: 120
      min: 0
      step: 1
    sun_bedroom_curtain_sunni_min:
      max: 9000
      min: 0
      step: 10
    sun_bedroom_curtain_cloudly_min:
      max: 9000
      min: 0
      step: 10
    sun_bedroom_backlight_sunni_max:
      max: 9000
      min: 0
      step: 10
    sun_bedroom_backlight_cloudly_max:
      max: 9000
      min: 0
      step: 10
    # living
    sun_living_cloud_level_min:
      max: 100
      min: 0
      step: 1
    sun_living_sensor_delay_on:
      max: 120
      min: 0
      step: 1
    sun_living_sensor_delay_off:
      max: 120
      min: 0
      step: 1
    sun_living_curtain_sunni_min:
      max: 9000
      min: 0
      step: 10
    sun_living_curtain_cloudly_min:
      max: 9000
      min: 0
      step: 10
    sun_living_backlight_sunni_max:
      max: 9000
      min: 0
      step: 10
    sun_living_backlight_cloudly_max:
      max: 9000
      min: 0
      step: 10

  template:
  - sensor: 
    - name: 'sun_cloud_level_virtual'
      icon: 'mdi:cloud-percent'
      unit_of_measurement: '%'
      state: "{{ states('sensor.openweathermap_cloud_coverage') | int(0) | round(0) }}"
    - name: 'sun_illuminance_virtual'
      icon: 'mdi:white-balance-sunny'
      unit_of_measurement: 'lx'
      state: "{{ states('sensor.balcony_illuminance') | int(0) | round(0) }}"
    # kitchen
    - name: 'sun_kitchen_sensor_delay_on'
      device_class: duration
      state: "{{ states('input_number.sun_kitchen_sensor_delay_on') | int(0) | timestamp_custom('%H:%M:%S', false) }}"
    - name: 'sun_kitchen_sensor_delay_off'
      device_class: duration
      state: "{{ states('input_number.sun_kitchen_sensor_delay_off') | int(0) | timestamp_custom('%H:%M:%S', false) }}"
    # hall
    - name: 'sun_hall_sensor_delay_on'
      device_class: duration
      state: "{{ states('input_number.sun_hall_sensor_delay_on') | int(0) | timestamp_custom('%H:%M:%S', false) }}"
    - name: 'sun_hall_sensor_delay_off'
      device_class: duration
      state: "{{ states('input_number.sun_hall_sensor_delay_off') | int(0) | timestamp_custom('%H:%M:%S', false) }}"
    # bedroom
    - name: 'sun_bedroom_sensor_delay_on'
      device_class: duration
      state: "{{ states('input_number.sun_bedroom_sensor_delay_on') | int(0) | timestamp_custom('%H:%M:%S', false) }}"
    - name: 'sun_bedroom_sensor_delay_off'
      device_class: duration
      state: "{{ states('input_number.sun_bedroom_sensor_delay_off') | int(0) | timestamp_custom('%H:%M:%S', false) }}"
    # living
    - name: 'sun_living_sensor_delay_on'
      device_class: duration
      state: "{{ states('input_number.sun_living_sensor_delay_on') | int(0) | timestamp_custom('%H:%M:%S', false) }}"
    - name: 'sun_living_sensor_delay_off'
      device_class: duration
      state: "{{ states('input_number.sun_living_sensor_delay_off') | int(0) | timestamp_custom('%H:%M:%S', false) }}"

  - binary_sensor:
    # kitchen
    - name: 'sun_kitchen_is_cloudly'
      state: >
        {% set sensorValue = states('sensor.sun_cloud_level_virtual') | float(0) %}
        {% set minValue = states('input_number.sun_kitchen_cloud_level_min') | int(0) %}
        {{ minValue < sensorValue }}
    - name: 'sun_kitchen_curtain_is_bright'
      delay_on: "{{ states('sensor.sun_kitchen_sensor_delay_on') }}"
      delay_off: "{{ states('sensor.sun_kitchen_sensor_delay_off') }}"
      state: >
        {% set isCloudly = is_state('binary_sensor.sun_kitchen_is_cloudly', 'on') %}
        {% set sensorValue = states('sensor.sun_illuminance_virtual') | float(0) %}
        {% set cloudlyValue = states('input_number.sun_kitchen_curtain_cloudly_min') | float(0) %}
        {% set sunnyValue = states('input_number.sun_kitchen_curtain_sunni_min') | float(0) %}
        {% set minValue = iif(isCloudly, cloudlyValue, sunnyValue) %}
        {{ minValue <= sensorValue }}
    - name: 'sun_kitchen_backlight_is_dark'
      delay_on: "{{ states('sensor.sun_kitchen_sensor_delay_on') }}"
      delay_off: "{{ states('sensor.sun_kitchen_sensor_delay_off') }}"
      state: >
        {% set isCloudly = is_state('binary_sensor.sun_kitchen_is_cloudly', 'on') %}
        {% set sensorValue = states('sensor.sun_illuminance_virtual') | float(0) %}
        {% set cloudlyValue = states('input_number.sun_kitchen_backlight_cloudly_max') | float(0) %}
        {% set sunnyValue = states('input_number.sun_kitchen_backlight_sunni_max') | float(0) %}
        {% set maxValue = iif(isCloudly, cloudlyValue, sunnyValue) %}
        {{ maxValue >= sensorValue }}
    - name: 'sun_kitchen_toplight_is_dark'
      delay_on: "{{ states('sensor.sun_kitchen_sensor_delay_on') }}"
      delay_off: "{{ states('sensor.sun_kitchen_sensor_delay_off') }}"
      state: >
        {% set isCloudly = is_state('binary_sensor.sun_kitchen_is_cloudly', 'on') %}
        {% set sensorValue = states('sensor.sun_illuminance_virtual') | float(0) %}
        {% set cloudlyValue = states('input_number.sun_kitchen_toplight_cloudly_max') | float(0) %}
        {% set sunnyValue = states('input_number.sun_kitchen_toplight_sunni_max') | float(0) %}
        {% set maxValue = iif(isCloudly, cloudlyValue, sunnyValue) %}
        {{ maxValue >= sensorValue }}

    # hall
    - name: 'sun_hall_backlight_is_dark'
      delay_on: "{{ states('sensor.sun_hall_sensor_delay_on') }}"
      delay_off: "{{ states('sensor.sun_hall_sensor_delay_off') }}"
      state: >
        {% set sensorValue = states('sensor.sun_illuminance_virtual') | float(0) %}
        {% set maxValue = states('input_number.sun_hall_backlight_max') | float(0) %}
        {{ maxValue >= sensorValue }}
    - name: 'sun_hall_toplight_is_dark'
      delay_on: "{{ states('sensor.sun_hall_sensor_delay_on') }}"
      delay_off: "{{ states('sensor.sun_hall_sensor_delay_off') }}"
      state: >
        {% set sensorValue = states('sensor.sun_illuminance_virtual') | float(0) %}
        {% set maxValue = states('input_number.sun_hall_toplight_max') | float(0) %}
        {{ maxValue >= sensorValue }}

    # bedroom
    - name: 'sun_bedroom_is_cloudly'
      state: >
        {% set sensorValue = states('sensor.sun_cloud_level_virtual') | float(0) %}
        {% set minValue = states('input_number.sun_bedroom_cloud_level_min') | int(0) %}
        {{ minValue < sensorValue }}
    - name: 'sun_bedroom_curtain_is_bright'
      delay_on: "{{ states('sensor.sun_bedroom_sensor_delay_on') }}"
      delay_off: "{{ states('sensor.sun_bedroom_sensor_delay_off') }}"
      state: >
        {% set isCloudly = is_state('binary_sensor.sun_bedroom_is_cloudly', 'on') %}
        {% set sensorValue = states('sensor.sun_illuminance_virtual') | float(0) %}
        {% set cloudlyValue = states('input_number.sun_bedroom_curtain_cloudly_min') | float(0) %}
        {% set sunnyValue = states('input_number.sun_bedroom_curtain_sunni_min') | float(0) %}
        {% set minValue = iif(isCloudly, cloudlyValue, sunnyValue) %}
        {{ minValue <= sensorValue }}
    - name: 'sun_bedroom_backlight_is_dark'
      delay_on: "{{ states('sensor.sun_bedroom_sensor_delay_on') }}"
      delay_off: "{{ states('sensor.sun_bedroom_sensor_delay_off') }}"
      state: >
        {% set isCloudly = is_state('binary_sensor.sun_bedroom_is_cloudly', 'on') %}
        {% set sensorValue = states('sensor.sun_illuminance_virtual') | float(0) %}
        {% set cloudlyValue = states('input_number.sun_bedroom_backlight_cloudly_max') | float(0) %}
        {% set sunnyValue = states('input_number.sun_bedroom_backlight_sunni_max') | float(0) %}
        {% set maxValue = iif(isCloudly, cloudlyValue, sunnyValue) %}
        {{ maxValue >= sensorValue }}

    # living
    - name: 'sun_living_is_cloudly'
      state: >
        {% set sensorValue = states('sensor.sun_cloud_level_virtual') | float(0) %}
        {% set minValue = states('input_number.sun_living_cloud_level_min') | int(0) %}
        {{ minValue < sensorValue }}
    - name: 'sun_living_curtain_is_bright'
      delay_on: "{{ states('sensor.sun_living_sensor_delay_on') }}"
      delay_off: "{{ states('sensor.sun_living_sensor_delay_off') }}"
      state: >
        {% set isCloudly = is_state('binary_sensor.sun_living_is_cloudly', 'on') %}
        {% set sensorValue = states('sensor.sun_illuminance_virtual') | float(0) %}
        {% set cloudlyValue = states('input_number.sun_living_curtain_cloudly_min') | float(0) %}
        {% set sunnyValue = states('input_number.sun_living_curtain_sunni_min') | float(0) %}
        {% set minValue = iif(isCloudly, cloudlyValue, sunnyValue) %}
        {{ minValue <= sensorValue }}
    - name: 'sun_living_backlight_is_dark'
      delay_on: "{{ states('sensor.sun_living_sensor_delay_on') }}"
      delay_off: "{{ states('sensor.sun_living_sensor_delay_off') }}"
      state: >
        {% set isCloudly = is_state('binary_sensor.sun_living_is_cloudly', 'on') %}
        {% set sensorValue = states('sensor.sun_illuminance_virtual') | float(0) %}
        {% set cloudlyValue = states('input_number.sun_living_backlight_cloudly_max') | float(0) %}
        {% set sunnyValue = states('input_number.sun_living_backlight_sunni_max') | float(0) %}
        {% set maxValue = iif(isCloudly, cloudlyValue, sunnyValue) %}
        {{ maxValue >= sensorValue }}