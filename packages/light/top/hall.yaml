light_top_hall:
  light:
  - platform: group
    name: light_top_hall
    entities:
    - light.light_xiaomi_hall_1
    - light.light_xiaomi_hall_2
    - light.light_xiaomi_hall_3
    - light.light_xiaomi_hall_4
    - light.light_xiaomi_hall_5
    - light.light_xiaomi_hall_6
  
  input_number:
    light_top_hall_night_brightness: 
      max: 255
      min: 1
      # 50

  template:
  - sensor:
    - name: 'light_top_hall_temperature'
      unique_id: light_top_hall_temperature
      state: >
        {% set minValue = 175 %}
        {% set maxValue = 333 %}
        {% set target = states('sensor.climat_illuminance_max') | int(1) %}
        {% set sensor = states('sensor.climat_illuminance_virtual') | int(0) %}
        {% set percent = min((sensor / max(1, target) ) * 100, 100) | round %}
        {% set temperature = (maxValue / 100 * (100 - percent)) | round %}
        {{ max(minValue, temperature) }}

    - name: 'light_top_hall_brightness'
      unique_id: light_top_hall_brightness
      state: >
        {% set isNightMode = is_state('input_boolean.night_mode_hall', 'on') %}
        {% set nightValue = states('sensor.light_top_hall_night_brightness') | int(1) %}
        {% set dayValue = 255 %}
        {{ iif(isNightMode, nightValue, dayValue) }}