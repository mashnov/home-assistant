intercom_hall:
  lock:
  - platform: template
    name: intercom_hall
    value_template: "{{ is_state('input_boolean.intercom_hall_open', 'on') }}"
    lock:
    - service: input_boolean.turn_off
      entity_id: input_boolean.intercom_hall_open
    unlock:
    - service: input_boolean.turn_on
      entity_id: input_boolean.intercom_hall_open
    - service: switch.turn_on
      entity_id: switch.intercom_hall
    - delay: "{{ states('sensor.intercom_hall_delay') }}"
    - service: switch.turn_off
      entity_id: switch.intercom_hall
    - service: input_boolean.turn_off
      entity_id: input_boolean.intercom_hall_open

  input_boolean:
    intercom_hall_call:
    intercom_hall_open:
    intercom_hall_enabled:

  input_number:
    intercom_hall_delay:
      step: 0.5
      max: 10
      min: 0.5
      # 2.5

    intercom_hall_call:
      step: 0.5
      max: 20
      min: 0.5
      # 10

  template:
  - sensor:
    - name: intercom_hall_delay
      unique_id: intercom_hall_delay
      state: >
        {% set duration = states('input_number.intercom_hall_delay') | float(0) %}
        {{ duration | timestamp_custom('%H:%M:%S.%f', false) }}

    - name: intercom_hall_call_duration
      unique_id: intercom_hall_call_duration
      state: >
        {% set duration = states('input_number.intercom_hall_call') | float(0) %}
        {{ duration | timestamp_custom('%H:%M:%S.%f', false) }}
