camera_living:
  input_text:
    camera_living_photo_name:
      initial: 'snapshot.jpg'
    camera_living_photo_caption:
      initial: 'Камера в гостиной'

  template:
  - sensor:
    - name: 'camera_living_photo_link'
      state: >
        {% set path = '/tmp/' %}
        {% set name = states('input_text.camera_living_photo_name') %}
        {{ path + name }}

    - name: 'camera_living_photo_message'
      state: >
        {% set path = '/tmp/' %}
        {% set name = states('input_text.camera_living_photo_name') %}
        {{ path + name }}

  script:
    camera_living_take_photo:
      mode: 'queued'
      sequence:
      - service: camera.snapshot
        entity_id: camera.living
        data:
          filename: "{{ states('sensor.camera_living_photo_link') }}"
      - service: script.telegramm_send_photo
        data_template:
          message: "{{ states('sensor.camera_living_photo_caption') }}"
          link: "{{ states('sensor.camera_living_photo_link') }}"
  
  automation:
  - alias: 'camera_living_action'
    mode: 'queued'
    trigger:
    - platform: state
      entity_id: 'camera.living'
      to: 'active'
    action:
    - service: script.camera_living_take_photo
