## CURTAIN LEVEL SENSORS
- sensor:
  - name: 'curtain_kitchen_level'
    unit_of_measurement: '%'
    icon: 'mdi:arrow-expand-right'
    state: >
      {% set isNightMode = is_state('binary_sensor.night_mode_hall_boolean', 'on') %}
      {% set ignoreNightMode = is_state('input_boolean.curtain_kitchn_ignore_night_mode', 'on') %}
      {% set nightModePermission = not(ignoreNightMode) and isNightMode %}
      {% set isVentilation = is_state('binary_sensor.ventilation_kitchen_boolean', 'on') %}
      {% set ignoreVentilation = is_state('input_boolean.curtain_kitchn_ignore_ventilation', 'on') %}
      {% set ventilationPermission = not(ignoreVentilation) and isNightMode and isVentilation %}
      {% set isSunHight = is_state('binary_sensor.solar_hight', 'on') %}
      {% set isIlluminanceLow = is_state('binary_sensor.illuminance_kitchen_curtain_boolean', 'on') %}
      {% set ignoreIlluminance = is_state('input_boolean.curtain_kitchn_ignore_illuminance', 'on') %}
      {% set illuminancePermission = not(ignoreIlluminance) and not(isNightMode) and isSunHight and not(isIlluminanceLow) %}
      {% set nightPosition = nightModePermission and states('input_number.curtain_kitchen_night') %}
      {% set ventilationPosition = ventilationPermission and states('input_number.curtain_kitchen_ventilation') %}
      {% set sunnyPosition = illuminancePermission and states('input_number.curtain_kitchen_sun') %}
      {% set openPosition = states('input_number.curtain_kitchen_open') %}
      {{ ventilationPosition or nightPosition or sunnyPosition or openPosition }}

  - name: 'curtain_bedroom_level'
    unit_of_measurement: '%'
    icon: 'mdi:arrow-expand-right'
    state: >
      {% set isNightMode = is_state('binary_sensor.night_mode_bedroom_boolean', 'on') %}
      {% set ignoreNightMode = is_state('input_boolean.curtain_bedroom_ignore_night_mode', 'on') %}
      {% set nightModePermission = not(ignoreNightMode) and isNightMode %}
      {% set isVentilation = is_state('binary_sensor.ventilation_bedroom_boolean', 'on') %}
      {% set ignoreVentilation = is_state('input_boolean.curtain_bedroom_ignore_ventilation', 'on') %}
      {% set ventilationPermission = not(ignoreVentilation) and isNightMode and isVentilation %}
      {% set isSunHight = is_state('binary_sensor.solar_hight', 'on') %}
      {% set isIlluminanceLow = is_state('binary_sensor.illuminance_bedroom_curtain_boolean', 'on') %}
      {% set ignoreIlluminance = is_state('input_boolean.curtain_bedroom_ignore_illuminance', 'on') %}
      {% set illuminancePermission = not(ignoreIlluminance) and not(isNightMode) and isSunHight and not(isIlluminanceLow) %}
      {% set nightPosition = nightModePermission and states('input_number.curtain_bedroom_night') %}
      {% set ventilationPosition = ventilationPermission and states('input_number.curtain_bedroom_ventilation') %}
      {% set sunnyPosition = illuminancePermission and states('input_number.curtain_bedroom_sun') %}
      {% set openPosition = states('input_number.curtain_bedroom_open') %}
      {{ ventilationPosition or nightPosition or sunnyPosition or openPosition }}

  - name: 'curtain_living_level'
    unit_of_measurement: '%'
    icon: 'mdi:arrow-expand-right'
    state: >
      {% set isNightMode = is_state('binary_sensor.night_mode_living_boolean', 'on') %}
      {% set ignoreNightMode = is_state('input_boolean.curtain_living_ignore_night_mode', 'on') %}
      {% set nightModePermission = not(ignoreNightMode) and isNightMode %}
      {% set isVentilation = is_state('binary_sensor.ventilation_living_boolean', 'on') %}
      {% set ignoreVentilation = is_state('input_boolean.curtain_living_ignore_ventilation', 'on') %}
      {% set ventilationPermission = not(ignoreVentilation) and isNightMode and isVentilation %}
      {% set isSunHight = is_state('binary_sensor.solar_hight', 'on') %}
      {% set isIlluminanceLow = is_state('binary_sensor.illuminance_living_curtain_boolean', 'on') %}
      {% set ignoreIlluminance = is_state('input_boolean.curtain_living_ignore_illuminance', 'on') %}
      {% set illuminancePermission = not(ignoreIlluminance) and not(isNightMode) and isSunHight and not(isIlluminanceLow) %}
      {% set nightPosition = nightModePermission and states('input_number.curtain_living_night') %}
      {% set ventilationPosition = ventilationPermission and states('input_number.curtain_living_ventilation') %}
      {% set sunnyPosition = illuminancePermission and states('input_number.curtain_living_sun') %}
      {% set openPosition = states('input_number.curtain_living_open') %}
      {{ ventilationPosition or nightPosition or sunnyPosition or openPosition }}

## CURTAIN POSITION SENSORS
  - name: 'curtain_kitchen_position'
    unit_of_measurement: '%'
    state: "{{ state_attr('cover.curtain_kitchen', 'position') | int(0) }}"
    icon: >
      {% set isOpen = is_state('binary_sensor.curtain_kitchen_open', 'on') %}
      {{ iif(isOpen, 'mdi:arrow-left-bold-circle-outline', 'mdi:arrow-right-bold-circle-outline', 'mdi:help-circle') }}

  - name: 'curtain_bedroom_position'
    unit_of_measurement: '%'
    state: "{{ state_attr('cover.curtain_bedroom', 'position') | int(0) }}"
    icon: >
      {% set isOpen = is_state('binary_sensor.curtain_bedroom_open', 'on') %}
      {{ iif(isOpen, 'mdi:arrow-left-bold-circle-outline', 'mdi:arrow-right-bold-circle-outline', 'mdi:help-circle') }}

  - name: 'curtain_living_position'
    unit_of_measurement: '%'
    state: "{{ state_attr('cover.curtain_living', 'position') | int(0) }}"
    icon: >
      {% set isOpen = is_state('binary_sensor.curtain_living_open', 'on') %}
      {{ iif(isOpen, 'mdi:arrow-left-bold-circle-outline', 'mdi:arrow-right-bold-circle-outline', 'mdi:help-circle') }}

## CURTAIN OPEN SENSORS
- binary_sensor:
  - name: 'curtain_kitchen_open'
    device_class: 'opening'
    icon: 'mdi:curtains'
    state: >
      {% set sensorValue = states('sensor.curtain_kitchen_position') | int(0) %}
      {% set closeValue = states('input_number.curtain_kitchen_close') | int(0) %}
      {{ sensorValue < closeValue }}

  - name: 'curtain_bedroom_open'
    device_class: 'opening'
    icon: 'mdi:curtains'
    state: >
      {% set sensorValue = states('sensor.curtain_bedroom_position') | int(0) %}
      {% set closeValue = states('input_number.curtain_bedroom_close') | int(0) %}
      {{ sensorValue < closeValue }}

  - name: 'curtain_living_open'
    device_class: 'opening'
    icon: 'mdi:curtains'
    state: >
      {% set sensorValue = states('sensor.curtain_living_position') | int(0) %}
      {% set closeValue = states('input_number.curtain_living_close') | int(0) %}
      {{ sensorValue < closeValue }}
