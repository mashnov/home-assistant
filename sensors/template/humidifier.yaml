## HUMIDIFIER EMPTY SENSORS
- binary_sensor:
  - name: 'humidifier_hall_empty'
    icon: 'mdi:water-alert-outline'
    device_class: 'problem'
    state: >
      {% set humidifierIsOn = is_state('binary_sensor.humidifier_hall_on', 'on') %}
      {% set backlightIsOn = is_state('binary_sensor.back_light_hall_on', 'on') %}
      {% set humidifierMinPower = 1 %}
      {% set backlightMinPower = states('input_number.power_offset_hall') | int(0) %}
      {% set relayMinPower = backlightMinPower + humidifierMinPower %}
      {% set sensorValue = states('sensor.relay_hall_power') | int(0) %}
      {% set expectedValue = iif(backlightIsOn, relayMinPower, humidifierMinPower) %}
      {{ humidifierIsOn and (sensorValue <= expectedValue) }}

  - name: 'humidifier_bedroom_empty'
    icon: 'mdi:water-alert-outline'
    device_class: 'problem'
    state: >
      {% set humidifierIsOn = is_state('binary_sensor.humidifier_bedroom_on', 'on') %}
      {% set backlightIsOn = is_state('binary_sensor.back_light_bedroom_1_on', 'on') %}
      {% set humidifierMinPower = 1 %}
      {% set backlightMinPower = states('input_number.power_offset_bedroom') | int(0) %}
      {% set relayMinPower = backlightMinPower + humidifierMinPower %}
      {% set sensorValue = states('sensor.relay_bedroom_power') | int(0) %}
      {% set expectedValue = iif(backlightIsOn, relayMinPower, humidifierMinPower) %}
      {{ humidifierIsOn and (sensorValue <= expectedValue) }}

  - name: 'humidifier_living_empty'
    icon: 'mdi:water-alert-outline'
    device_class: 'problem'
    state: >
      {% set humidifierIsOn = is_state('binary_sensor.humidifier_living_on', 'on') %}
      {% set backlightIsOn = is_state('binary_sensor.back_light_living_on', 'on') %}
      {% set humidifierMinPower = 1 %}
      {% set backlightMinPower = states('input_number.power_offset_living') | int(0) %}
      {% set relayMinPower = backlightMinPower + humidifierMinPower %}
      {% set sensorValue = states('sensor.relay_living_power') | int(0) %}
      {% set expectedValue = iif(backlightIsOn, relayMinPower, humidifierMinPower) %}
      {{ humidifierIsOn and (sensorValue <= expectedValue) }}

## HUMIDIFIER EMPTY BOOLEAN SENSORS
  - name: 'humidifier_hall_empty_boolean'
    device_class: 'problem'
    icon: 'mdi:air-humidifier-off'
    state: "{{ is_state('input_boolean.humidifier_hall_empty', 'on') }}"

  - name: 'humidifier_bedroom_empty_boolean'
    device_class: 'problem'
    icon: 'mdi:air-humidifier-off'
    state: "{{ is_state('input_boolean.humidifier_bedroom_empty', 'on') }}"

  - name: 'humidifier_living_empty_boolean'
    device_class: 'problem'
    icon: 'mdi:air-humidifier-off'
    state: "{{ is_state('input_boolean.humidifier_living_empty', 'on') }}"

## HUMIDIFIER ON SENSORS
  - name: 'humidifier_hall_on'
    device_class: 'plug'
    state: "{{ is_state('binary_sensor.relay_hall_2_on', 'on') }}"
    icon: 'mdi:air-humidifier'

  - name: 'humidifier_bedroom_on'
    device_class: 'plug'
    state: "{{ is_state('binary_sensor.relay_bedroom_2_on', 'on') }}"
    icon: 'mdi:air-humidifier'

  - name: 'humidifier_living_on'
    device_class: 'plug'
    state: "{{ is_state('binary_sensor.relay_living_1_on', 'on') }}"
    icon: 'mdi:air-humidifier'

## HUMIDIFIER PERMISSION
  - name: 'humidifier_hall_permission'
    device_class: 'lock'
    icon: 'mdi:check-all'
    state: >
      {% set isVentilation = is_state('binary_sensor.ventilation_hall_boolean', 'on') %}
      {% set ignoreVentilation = is_state('input_boolean.hudration_hall_ignore_ventilation', 'on') %}
      {% set ventilationPermission = not(isVentilation) or ignoreVentilation %}
      {% set isNightMode = is_state('binary_sensor.night_mode_hall_boolean', 'on') %}
      {% set ignoreNightMode = is_state('input_boolean.hudration_hall_ignore_night_mode', 'on') %}
      {% set nightModePermission = not(isNightMode) or ignoreNightMode %}
      {% set isDry = is_state('binary_sensor.humidity_hall_low', 'on') %}
      {{ ventilationPermission and nightModePermission and isDry }}

  - name: 'humidifier_bedroom_permission'
    device_class: 'lock'
    icon: 'mdi:check-all'
    state: >
      {% set isVentilation = is_state('binary_sensor.ventilation_bedroom_boolean', 'on') %}
      {% set ignoreVentilation = is_state('input_boolean.hudration_bedroom_ignore_ventilation', 'on') %}
      {% set ventilationPermission = not(isVentilation) or ignoreVentilation %}
      {% set isNightMode = is_state('binary_sensor.night_mode_bedroom_boolean', 'on') %}
      {% set ignoreNightMode = is_state('input_boolean.hudration_bedroom_ignore_night_mode', 'on') %}
      {% set nightModePermission = not(isNightMode) or ignoreNightMode %}
      {% set isDry = is_state('binary_sensor.humidity_bedroom_low', 'on') %}
      {{ ventilationPermission and nightModePermission and isDry }}

  - name: 'humidifier_living_permission'
    device_class: 'lock'
    icon: 'mdi:check-all'
    state: >
      {% set isVentilation = is_state('binary_sensor.ventilation_living_boolean', 'on') %}
      {% set ignoreVentilation = is_state('input_boolean.hudration_living_ignore_ventilation', 'on') %}
      {% set ventilationPermission = not(isVentilation) or ignoreVentilation %}
      {% set isNightMode = is_state('binary_sensor.night_mode_living_boolean', 'on') %}
      {% set ignoreNightMode = is_state('input_boolean.hudration_living_ignore_night_mode', 'on') %}
      {% set nightModePermission = not(isNightMode) or ignoreNightMode %}
      {% set isDry = is_state('binary_sensor.humidity_living_low', 'on') %}
      {{ ventilationPermission and nightModePermission and isDry }}
