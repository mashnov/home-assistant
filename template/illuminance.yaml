- binary_sensor:
  - name: 'illuminance'
    device_class: 'light'
    state: >
      {% set kitchenCValue = state_attr("sensor.illuminance", "kitchen_curtain_boolean") %}
      {% set kitchenTlValue = state_attr("sensor.illuminance", "kitchen_top_light_boolean") %}
      {% set kitchenBlValue = state_attr("sensor.illuminance", "kitchen_back_light_boolean") %}
      {% set hallTlValue = state_attr("sensor.illuminance", "hall_top_light_boolean") %}
      {% set hallBlValue = state_attr("sensor.illuminance", "hall_back_light_boolean") %}
      {% set bedroomCValue = state_attr("sensor.illuminance", "bedroom_curtain_boolean") %}
      {% set bedroomBlValue = state_attr("sensor.illuminance", "bedroom_back_light_boolean") %}
      {% set livingCValue = state_attr("sensor.illuminance", "living_curtain_boolean") %}
      {% set livingBlValue = state_attr("sensor.illuminance", "living_back_light_boolean") %}
      {{ kitchenCValue or kitchenTlValue or kitchenBlValue or hallTlValue or hallBlValue or bedroomCValue or bedroomBlValue or livingCValue or livingBlValue }}

    icon: 'mdi:camera-timer'
    attributes:
      illuminance_sensor: "{{ state_attr('sensor.balcony_illuminance', 'illuminance_lux') | int(0) }}"
      
      kitchen_curtain_state: >
        {% set isCloudly = state_attr('sensor.cloud', 'cloud_boolean') %}
        {% set targetCloudly = states('input_number.i_kitchen_curtain_cloudly_target') | int(0) %}
        {% set targetSunny = states('input_number.i_kitchen_curtain_sunny_target') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = states('input_number.i_level') | int(0) %}
        {{ sensorValue > targetValue }}
      kitchen_top_light_state: >
        {% set isCloudly = state_attr('sensor.cloud', 'cloud_boolean') %}
        {% set targetCloudly = states('input_number.i_kitchen_top_light_cloudly_target') | int(0) %}
        {% set targetSunny = states('input_number.i_kitchen_top_light_sunny_target') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = states('input_number.i_level') | int(0) %}
        {{ sensorValue < targetValue }}
      kitchen_back_light_state: >
        {% set isCloudly = state_attr('sensor.cloud', 'cloud_boolean') %}
        {% set targetCloudly = states('input_number.i_kitchen_back_light_cloudly_target') | int(0) %}
        {% set targetSunny = states('input_number.i_kitchen_back_light_sunny_target') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = states('input_number.i_level') | int(0) %}
        {{ sensorValue < targetValue }}
      hall_top_light_state: >
        {% set isCloudly = state_attr('sensor.cloud', 'cloud_boolean') %}
        {% set targetCloudly = states('input_number.i_hall_top_light_cloudly_target') | int(0) %}
        {% set targetSunny = states('input_number.i_hal_top_light_sunny_target') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = states('input_number.i_level') | int(0) %}
        {{ sensorValue < targetValue }}
      hall_back_light_state: >
        {% set isCloudly = state_attr('sensor.cloud', 'cloud_boolean') %}
        {% set targetCloudly = states('input_number.i_hall_back_light_cloudly_target') | int(0) %}
        {% set targetSunny = states('input_number.i_hal_back_light_sunny_target') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = states('input_number.i_level') | int(0) %}
        {{ sensorValue < targetValue }}
      bedroom_curtain_state: >
        {% set isCloudly = state_attr('sensor.cloud', 'cloud_boolean') %}
        {% set targetCloudly = states('input_number.i_bedroom_curtain_cloudly_target') | int(0) %}
        {% set targetSunny = states('input_number.i_bedroom_curtain_sunny_target') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = states('input_number.i_level') | int(0) %}
        {{ sensorValue > targetValue }}
      bedroom_back_light_state: >
        {% set isCloudly = state_attr('sensor.cloud', 'cloud_boolean') %}
        {% set targetCloudly = states('input_number.i_bedroom_back_light_cloudly_target') | int(0) %}
        {% set targetSunny = states('input_number.i_bedroom_back_light_sunny_target') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = states('input_number.i_level') | int(0) %}
        {{ sensorValue < targetValue }}
      living_curtain_state: >
        {% set isCloudly = state_attr('sensor.cloud', 'cloud_boolean') %}
        {% set targetCloudly = states('input_number.i_living_curtain_cloudly_target') | int(0) %}
        {% set targetSunny = states('input_number.i_living_curtain_sunny_target') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = states('input_number.i_level') | int(0) %}
        {{ sensorValue > targetValue }}
      living_back_light_state: >
        {% set isCloudly = state_attr('sensor.cloud', 'cloud_boolean') %}
        {% set targetCloudly = states('input_number.i_living_backlight_cloudly_target') | int(0) %}
        {% set targetSunny = states('input_number.i_living_backlight_sunny_target') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = states('input_number.i_level') | int(0) %}
        {{ sensorValue < targetValue }}

      kitchen_curtain_boolean: "{{ is_state('input_boolean.i_kitchen_curtain', 'on') }}"
      bedroom_curtain_boolean: "{{ is_state('input_boolean.i_bedroom_curtain', 'on') }}"
      living_curtain_boolean: "{{ is_state('input_boolean.i_living_curtain', 'on') }}"
      kitchen_top_light_boolean: "{{ is_state('input_boolean.i_kitchen_top_light', 'on') }}"
      hall_top_light_boolean: "{{ is_state('input_boolean.i_hall_top_light', 'on') }}"
      kitchen_back_light_boolean: "{{ is_state('input_boolean.i_kitchen_back_light', 'on') }}"
      hall_back_light_boolean: "{{ is_state('input_boolean.i_hall_back_light', 'on') }}"
      bedroom_back_light_boolean: "{{ is_state('input_boolean.i_bedroom_back_light', 'on') }}"
      living_back_light_boolean: "{{ is_state('input_boolean.i_living_back_light', 'on') }}"
