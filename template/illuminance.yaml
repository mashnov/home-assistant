## ILLUMINANCE
- sensor:
  - name: 'illuminance'
    device_class: 'illuminance'
    unit_of_measurement: 'lx'
    state: "{{ state_attr('sensor.pressure', 'balcony') | int(0) }}"
    icon: >
      {% set isLow = is_state('binary_sensor.illuminance', 'on') %}
      {{ iif(isLow, 'mdi:brightness-7', 'mdi:brightness-5', 'mdi:help-circle') }}
    attributes:
      balcony: "{{ state_attr('sensor.balcony_illuminance', 'illuminance_lux') | int(0) }}"
      kitchen: "{{ state_attr('sensor.kitchen_motion', 'illuminance_lux') | int(1) }}"
      hall: "{{ state_attr('sensor.hall_motion', 'illuminance_lux') | int(1) }}"

- binary_sensor:
  - name: 'illuminance'
    state: >
      {% set kitchenCurtainValue = state_attr('sensor.illuminance', 'kitchen_curtain') %}
      {% set bedroomCurtainValue = state_attr('sensor.illuminance', 'bedroom_curtain') %}
      {% set livingCurtainValue = state_attr('sensor.illuminance', 'living_curtain') %}
      {{ kitchenCurtainValue or bedroomCurtainValue or livingCurtainValue }}
    icon: >
      {% set isLow = is_state('binary_sensor.illuminance', 'on') %}
      {{ iif(isLow, 'mdi:brightness-7', 'mdi:brightness-5', 'mdi:help-circle') }}
    attributes: 
      kitchen_curtain: >
        {% set isCloudly = state_attr('binary_sensor.cloud', 'cloudly') %}
        {% set targetCloudly = states('input_number.illuminance_kitchen_curtain_target_cloudly') | int(0) %}
        {% set targetSunny = states('input_number.illuminance_kitchen_curtain_target_sunny') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = state_attr('sensor.illuminance', 'balcony') | int(0) %}
        {{ sensorValue > targetValue }}
      bedroom_curtain: >
        {% set isCloudly = state_attr('binary_sensor.cloud', 'cloudly') %}
        {% set targetCloudly = states('input_number.illuminance_bedroom_curtain_target_cloudly') | int(0) %}
        {% set targetSunny = states('input_number.illuminance_bedroom_curtain_target_sunny') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = state_attr('sensor.illuminance', 'balcony') | int(0) %}
        {{ sensorValue > targetValue }}
      living_curtain: >
        {% set isCloudly = state_attr('binary_sensor.cloud', 'cloudly') %}
        {% set targetCloudly = states('input_number.illuminance_living_curtain_target_cloudly') | int(0) %}
        {% set targetSunny = states('input_number.illuminance_living_curtain_target_sunny') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = state_attr('sensor.illuminance', 'balcony') | int(0) %}
        {{ sensorValue > targetValue }}

      kitchen_top_light: >
        {% set isCloudly = state_attr('binary_sensor.cloud', 'cloudly') %}
        {% set targetCloudly = states('input_number.illuminance_kitchen_top_light_target_cloudly') | int(0) %}
        {% set targetSunny = states('input_number.illuminance_kitchen_top_light_target_sunny') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = state_attr('sensor.illuminance', 'balcony') | int(0) %}
        {{ sensorValue < targetValue }}
      hall_top_light: >
        {% set isCloudly = state_attr('binary_sensor.cloud', 'cloudly') %}
        {% set targetCloudly = states('input_number.illuminance_hall_top_light_target_cloudly') | int(0) %}
        {% set targetSunny = states('input_number.illuminance_hall_top_light_target_sunny') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = state_attr('sensor.illuminance', 'balcony') | int(0) %}
        {{ sensorValue < targetValue }}

      kitchen_back_light: >
        {% set isCloudly = state_attr('binary_sensor.cloud', 'cloudly') %}
        {% set targetCloudly = states('input_number.illuminance_kitchen_back_light_target_cloudly') | int(0) %}
        {% set targetSunny = states('input_number.illuminance_kitchen_back_light_target_sunny') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = state_attr('sensor.illuminance', 'balcony') | int(0) %}
        {{ sensorValue < targetValue }}
      hall_back_light: >
        {% set isCloudly = state_attr('binary_sensor.cloud', 'cloudly') %}
        {% set targetCloudly = states('input_number.illuminance_hall_bakc_light_target_cloudly') | int(0) %}
        {% set targetSunny = states('input_number.illuminance_hall_bakc_light_target_sunny') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = state_attr('sensor.illuminance', 'balcony') | int(0) %}
        {{ sensorValue < targetValue }}
      bedroom_back_light: >
        {% set isCloudly = state_attr('binary_sensor.cloud', 'cloudly') %}
        {% set targetCloudly = states('input_number.illuminance_bedroom_back_light_target_cloudly') | int(0) %}
        {% set targetSunny = states('input_number.illuminance_bedroom_back_light_target_sunny') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = state_attr('sensor.illuminance', 'balcony') | int(0) %}
        {{ sensorValue < targetValue }}
      living_back_light: >
        {% set isCloudly = state_attr('binary_sensor.cloud', 'cloudly') %}
        {% set targetCloudly = states('input_number.illuminance_living_back_light_target_cloudly') | int(0) %}
        {% set targetSunny = states('input_number.illuminance_living_back_light_target_sunny') | int(0) %}
        {% set targetValue = iif(isCloudly, targetCloudly, targetSunny) %}
        {% set sensorValue = state_attr('sensor.illuminance', 'balcony') | int(0) %}
        {{ sensorValue < targetValue }}
