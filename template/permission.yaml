- binary_sensor:
  - name: 'permission_party_light'
    device_class: 'lock'
    state: "{{ state_attr('binary_sensor.permission_party_light', 'kitchen') }}"
    icon: 'mdi:check-all'
    attributes:
      kitchen: "{{ is_state('input_boolean.permission_kitchen_party_light', 'on') }}"

  - name: 'permission_top_light'
    device_class: 'lock'
    state: >
      {% set kitchenValue = state_attr('binary_sensor.permission_top_light', 'kitchen') %}
      {% set hallValue = state_attr('binary_sensor.permission_top_light', 'hall') %}
      {% set bathValue = state_attr('binary_sensor.permission_top_light', 'bath') %}
      {% set toiletValue = state_attr('binary_sensor.permission_top_light', 'toilet') %}
      {% set bedroomValue = state_attr('binary_sensor.permission_top_light', 'bedroom') %}
      {% set livingValue = state_attr('binary_sensor.permission_top_light', 'living') %}
      {{ kitchenValue or hallValue or bathValue or toiletValue or bedroomValue or livingValue }}
    icon: 'mdi:check-all'
    attributes:    
      kitchen: >
        {% set isOccupancy = is_state('input_boolean.occupancy_kitchen', 'on') %}
        {% set isLowSunBright = is_state('input_boolean.illuminance_kitchen_top_light', 'on') %}
        {% set isNightTime = state_attr('binary_sensor.date_time', 'night') %}
        {{ not(isNightTime) and isOccupancy and isLowSunBright }}
      hall: >
        {% set isOccupancy = is_state('input_boolean.occupancy_hall', 'on') %}
        {% set isLowSunBright = is_state('input_boolean.illuminance_hall_top_light', 'on') %}
        {% set isNightTime = state_attr('binary_sensor.date_time', 'night') %}
        {{ not(isNightTime) and isOccupancy and isLowSunBright }}
      bath:  >
        {% set isOccupancy = is_state('input_boolean.occupancy_bath', 'on') %}
        {% set isNightTime = state_attr('binary_sensor.date_time', 'night') %}
        {{ not(isNightTime) and isOccupancy }}
      toilet:  >
        {% set isOccupancy = is_state('input_boolean.occupancy_toilet', 'on') %}
        {% set isNightTime = state_attr('binary_sensor.date_time', 'night') %}
        {{ not(isNightTime) and isOccupancy }}
      bedroom: false ### TODO
      living: false ### TODO

  - name: 'permission_back_light'
    device_class: 'lock'
    state: >
      {% set kitchenValue = state_attr('binary_sensor.permission_back_light', 'kitchen') %}
      {% set hallValue = state_attr('binary_sensor.permission_back_light', 'hall') %}
      {% set bedroomValue = state_attr('binary_sensor.permission_back_light', 'bedroom') %}
      {% set livingValue = state_attr('binary_sensor.permission_back_light', 'living') %}
      {% set balconyValue = state_attr('binary_sensor.permission_back_light', 'balcony') %}
      {{ kitchenValue or hallValue or bedroomValue or balconyValue }}
    icon: 'mdi:check-all'
    attributes:
      kitchen: >
        {% set isOccupancy = is_state('input_boolean.occupancy_kitchen', 'on') %}
        {% set isLowSunBright = is_state('input_boolean.illuminance_kitchen_back_light', 'on') %}
        {% set isNightTime = state_attr('binary_sensor.date_time', 'night') %}
        {{ not(isNightTime) and isOccupancy and isLowSunBright }}
      hall: >
        {% set isLowSunBright = is_state('input_boolean.illuminance_hall_back_light', 'on') %}
        {% set isNightTime = state_attr('binary_sensor.date_time', 'night') %}
        {{ not(isNightTime) and isLowSunBright }}
      bedroom: >
        {% set isLowSunBright = is_state('input_boolean.illuminance_bedroom_back_light', 'on') %}
        {% set isNightTime = state_attr('binary_sensor.date_time', 'night') %}
        {{ not(isNightTime) and isLowSunBright }}
      living: >
        {% set isLowSunBright = is_state('input_boolean.illuminance_living_back_light', 'on') %}
        {% set isNightTime = state_attr('binary_sensor.date_time', 'night') %}
        {{ not(isNightTime) and isLowSunBright }}
      balcony: false ### TODO

  - name: 'permission_night_light'
    device_class: 'lock'
    state: >
      {% set kitchenValue = state_attr('binary_sensor.permission_night_light', 'kitchen') %}
      {% set hallValue = state_attr('binary_sensor.permission_night_light', 'hall') %}
      {% set bathValue = state_attr('binary_sensor.permission_night_light', 'bath') %}
      {% set toiletValue = state_attr('binary_sensor.permission_night_light', 'toilet') %}
      {% set balconyValue = state_attr('binary_sensor.permission_night_light', 'balcony') %}
      {{ kitchenValue or hallValue or bathValue or toiletValue or balconyValue }}
    icon: 'mdi:check-all'
    attributes:
      kitchen: >
        {% set isOccupancy = is_state('input_boolean.occupancy_kitchen', 'on') %}
        {% set isNightTime = state_attr('binary_sensor.date_time', 'night') %}
        {{ isNightTime and isOccupancy }}
      hall: >
        {% set isOccupancy = is_state('input_boolean.occupancy_hall', 'on') %}
        {{ isOccupancy }}
      bath: >
        {% set isOccupancy = is_state('input_boolean.occupancy_bath', 'on') %}
        {{ isOccupancy }}
      toilet: >
        {% set isOccupancy = is_state('input_boolean.occupancy_toilet', 'on') %}
        {{ isOccupancy }}
      balcony: false ### TODO

  - name: 'permission_humidifier'
    device_class: 'lock'
    state: >
      {% set hallValue = state_attr('binary_sensor.permission_humidifier', 'hall') %}
      {% set bedroomValue = state_attr('binary_sensor.permission_humidifier', 'bedroom') %}
      {% set livingValue = state_attr('binary_sensor.permission_humidifier', 'living') %}
      {{ hallValue or bedroomValue or livingValue }}
    icon: 'mdi:check-all'
    attributes:
      hall: >
        {% set isVentilation = is_state('input_boolean.ventilation_hall', 'on') %}
        {% set isNightTime = state_attr('binary_sensor.date_time', 'night') %}
        {% set isDry = state_attr('binary_sensor.humidity_hall', 'low') %}
        {{ not(isVentilation) and not(isNightTime) and isDry }}
      bedroom: >
        {% set isVentilation = is_state('input_boolean.ventilation_bedroom', 'on') %}
        {% set isNightTime = state_attr('binary_sensor.date_time', 'night') %}
        {% set isDry = state_attr('binary_sensor.humidity_bedroom', 'low') %}
        {{ not(isVentilation) and not(isNightTime) and isDry }}
      living: >
        {% set isVentilation = is_state('input_boolean.ventilation_living', 'on') %}
        {% set isNightTime = state_attr('binary_sensor.date_time', 'night') %}
        {% set isDry = state_attr('binary_sensor.humidity_living', 'low') %}
        {{ not(isVentilation) and not(isNightTime) and isDry }}

  - name: 'permission_dehumidifier'
    device_class: 'lock'
    state: >
      {% set bathValue = state_attr('binary_sensor.permission_dehumidifier', 'bath') %}
      {% set toiletValue = state_attr('binary_sensor.permission_dehumidifier', 'toilet') %}
      {{ bathValue or toiletValue }}
    icon: 'mdi:check-all'
    attributes:
      bath: "{{ state_attr('binary_sensor.humidity_bath', 'hight') }}"
      toilet: "{{ is_state('input_boolean.permission_dehumidifier_toilet', 'on') }}" ### TODO


