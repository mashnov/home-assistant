- sensor:
  - name: 'v_delay'
    device_class: duration
    icon: 'mdi:camera-timer'
    state: "{{ states('input_number.v_delay') | int(0) | timestamp_custom('%H:%M:%S', false) }}"

- binary_sensor:
  - name: 'v_kitchen'
    device_class: 'window'
    state: "{{ state_attr('sensor.window', 'kitchen') }}"
    delay_on: "{{ states('sensor.w_delay') }}"
    delay_off: "{{ states('sensor.w_delay') }}"
  - name: 'v_bedroom'
    device_class: 'window'
    state: "{{ state_attr('sensor.window', 'bedroom') }}"
    delay_on: "{{ states('sensor.w_delay') }}"
    delay_off: "{{ states('sensor.w_delay') }}"
  - name: 'v_living'
    device_class: 'window'
    state: "{{ state_attr('sensor.window', 'living') }}"
    delay_on: "{{ states('sensor.w_delay') }}"
    delay_off: "{{ states('sensor.w_delay') }}"

  - name: 'ventilation'
    device_class: 'opening'
    state: >
      {% set kitchenValue = state_attr('binary_sensor.ventilation', 'kitchen') %}
      {% set hallValue = state_attr('binary_sensor.ventilation', 'hall') %}
      {% set bedroomValue = state_attr('binary_sensor.ventilation', 'bedroom') %}
      {% set livingValue = state_attr('binary_sensor.ventilation', 'living') %}
      {{ kitchenValue or hallValue or bedroomValue or livingValue }}
    icon: >
      {% set isClose = is_state('binary_sensor.ventilation', 'off') %}
      {% set cIcon = 'mdi:tailwind' %}
      {% set oIcon = 'mdi:weather-windy' %}
      {{ iif(isClose, nIcon, hIcon) }}
    attributes:
      kitchen: "{{ is_state('binary_sensor.v_kitchen', 'on') }}"
      bedroom: "{{ is_state('binary_sensor.v_bedroom', 'on') }}"
      living: > 
        {% set livingValue = is_state('binary_sensor.v_living', 'on') %}
        {% set balconyValue = state_attr('binary_sensor.door', 'balcony') %}
        {{ livingValue or balconyValue }}
      hall: >
        {% set d_hall = state_attr('binary_sensor.door', 'hall') %}
        {% set d_bedroom = state_attr('binary_sensor.door', 'bedroom') %}
        {% set d_living = state_attr('binary_sensor.door', 'living') %}
        {% set v_kitchen = state_attr('binary_sensor.ventilation', 'kitchen') %}
        {% set v_bedroom = state_attr('binary_sensor.ventilation', 'bedroom') %}
        {% set v_living = state_attr('binary_sensor.ventilation', 'living') %}
        {% set bedroomValue = v_bedroom and d_bedroom %}
        {% set livingValue = v_living and d_living %}
        {{ v_kitchen or d_hall or bedroomValue or livingValue }}
