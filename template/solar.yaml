- sensor:
  - name: 'solar'
    device_class: 'illuminance'
    unit_of_measurement: 'lx'
    state: '{{ state_attr("sensor.solar", "illuminance") }}'
    icon: >
      {% set isHightIcon = state_attr('sensor.solar', 'hight') and 'mdi:sun-wireless' %}
      {% set isLowIcon = not(isHight) and 'mdi:weather-sunny' %}
      {{ isHightIcon or isLowIcon }}
    attributes:
      illuminance: '{{ state_attr("sensor.balcony_illuminance", "illuminance_lux") | int(0) | round(1) }}'
      azimuth: '{{ state_attr("sun.sun", "azimuth") }}'
      elevation: '{{ state_attr("sun.sun", "elevation") }}'
      hight: >
        {% set azimuthSensor = state_attr('solar', 'azimuth') | int(0) %}
        {% set azimuthTarget = states('input_number.s_azimuth_target') | int(0) %}
        {% set azimuthOffset = states('input_number.s_azimuth_offset') | int(0) %}
        {% set azimuthMinValue = azimuthTarget - azimuthOffset %}
        {% set azimuthMaxValue = azimuthTarget + azimuthOffset %}
        {% set azimuthValue = azimuthMinValue < azimuthSensor < azimuthMaxValue %}
        {% set elevationSensor = state_attr('solar', 'elevation') | int(0) %}
        {% set elevationTarget = states('input_number.s_elevation_target') | int(0) %}
        {% set elevationOffset = states('input_number.s_elevation_offset') | int(0) %}        
        {% set elevationMinValue = elevationTarget - elevationOffset %}
        {% set elevationMaxValue = elevationTarget + elevationOffset %}
        {% set elevationValue = elevationMinValue < elevationSensor < elevationMaxValue %}
        {{ azimuthValue and elevationValue }}
