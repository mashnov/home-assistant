- binary_sensor:
  - name: 'ventilation'
    device_class: 'opening'
    state: >
      {% set kitchenValue = state_attr('binary_sensor.ventilation', 'kitchen') %}
      {% set hallValue = state_attr('binary_sensor.ventilation', 'hall') %}
      {% set bedroomValue = state_attr('binary_sensor.ventilation', 'bedroom') %}
      {% set livingValue = state_attr('binary_sensor.ventilation', 'living') %}
      {{ kitchenValue or hallValue or bedroomValue or livingValue }}
    icon: >
      {% set isOpenIcon = is_state('binary_sensor.ventilation', 'on') and 'mdi:weather-windy' %}
      {% set isCloseIcon = is_state('binary_sensor.ventilation', 'off') and 'mdi:tailwind' %}
      {% set defaultIcon = 'mdi:help-circle'%}
      {{ isOpenIcon or isCloseIcon or defaultIcon }}
    attributes:
      kitchen: >
        {% set leftValue = state_attr('binary_sensor.window', 'kitchen_left_delayed') %}
        {% set rightValue = state_attr('binary_sensor.window', 'kitchen_right_delayed') %}
        {{ leftValue or rightValue }}
      bedroom: >
        {% set leftValue = state_attr('binary_sensor.window', 'bedroom_left_delayed') %}
        {% set rightValue = state_attr('binary_sensor.window', 'bedroom_right_delayed') %}
        {{ leftValue or rightValue }}
      living: > 
        {% set windowValue = state_attr('binary_sensor.window', 'living_delayed') %}
        {% set doorValue = state_attr('binary_sensor.door', 'balcony_delayed') %}
        {{ windowValue or doorValue }}
      hall: >
        {% set d_hall = state_attr('binary_sensor.door', 'hall') %}
        {% set d_bedroom = state_attr('binary_sensor.door', 'bedroom') %}
        {% set d_living = state_attr('binary_sensor.door', 'living') %}
        {% set v_kitchen = state_attr('binary_sensor.ventilation', 'kitchen') %}
        {% set v_bedroom = state_attr('binary_sensor.ventilation', 'bedroom') %}
        {% set v_living = state_attr('binary_sensor.ventilation', 'living') %}
        {% set bedroomValue = v_bedroom and d_bedroom %}
        {% set livingValue = v_living and d_living %}
        {{ v_kitchen or d_hall or bedroomValue or livingValue }}
