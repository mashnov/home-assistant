- binary_sensor:
  - name: 'v_hall'
    device_class: window
    icon: "{{ iif(is_state('binary_sensor.v_hall', 'on'), 'mdi:weather-windy', 'mdi:tailwind') }}"
    state: >
      {% set b_shared = is_state('input_boolean.v_shared', 'on') %}
      {% set b_entry_door = is_state('input_boolean.v_entry_door', 'on') %}
      {% set v_kitchen = is_state('binary_sensor.v_kitchen', 'on') %}
      {% set v_hall = is_state('binary_sensor.v_hall_door', 'on') %}
      {% set v_bedroom = is_state('binary_sensor.v_bedroom', 'on') %}
      {% set v_living = is_state('binary_sensor.v_living', 'on') %}
      {% set d_bedroom = is_state('binary_sensor.d_bedroom', 'on') %}
      {% set d_living = is_state('binary_sensor.d_living', 'on') %}
      {% set kitchen = v_kitchen %}
      {% set hall = v_hall and b_entry_door %}
      {% set bedroom = v_bedroom and d_bedroom %}
      {% set living = v_living and d_living %}
      {{ iif(v_shared, kitchen or hall or bedroom or living, hall) }}
