- sensor:
  - name: 'm_duration'
    device_class: duration
    icon: 'mdi:clock-time-eleven-outline'
    state: >
      {% set isNight = is_state('binary_sensor.dt_is_night', 'on') %}
      {% set durationNight = states('sensor.m_duration_night') %}
      {% set durationDay = states('sensor.m_duration_day') %}
      {% set duration = iif(isNight, durationNight, durationDay) %}
      {{ duration | int(0) | timestamp_custom('%H:%M:%S', false) }}

- binary_sensor:
  - name: 'm_kitchen'
    device_class: motion
    state: "{{ states('binary_sensor.kitchen_motion') }}"

  - name: 'm_kitchen_is_occupancy'
    device_class: motion
    delay_off: "{{ states('sensor.m_duration') }}"
    icon: "{{ iif(is_state('binary_sensor.m_kitchen', 'on'), 'mdi:human-greeting', 'mdi:human-male') }}"
    state: "{{ states('binary_sensor.m_kitchen') }}"

  - name: 'm_hall'
    device_class: motion
    state: "{{ states('binary_sensor.hall_motion') }}"

  - name: 'm_hall_is_occupancy'
    device_class: motion
    delay_off: "{{ states('sensor.m_duration') }}"
    icon: "{{ iif(is_state('binary_sensor.m_hall', 'on'), 'mdi:human-greeting', 'mdi:human-male') }}"
    state: "{{ states('binary_sensor.m_hall') }}"

  - name: 'm_bath'
    device_class: motion
    state: "{{ states('binary_sensor.bath_motion') }}"

  - name: 'm_bath_is_occupancy'
    device_class: motion
    delay_off: "{{ states('sensor.m_duration') }}"
    icon: "{{ iif(is_state('binary_sensor.m_bath', 'on'), 'mdi:human-greeting', 'mdi:human-male') }}"
    state: "{{ states('binary_sensor.m_bath') }}"
