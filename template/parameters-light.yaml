## PARAMETERS LIGHT
- sensor:
  - name: 'parameters_light'
    unit_of_measurement: 'Â°'
    state: "{{ state_attr('sensor.parameters_light', 'persent') | int(0) }}"
    icon: "mdi:cog"
    attributes:
      persent: >
        {% set maxValuePerDay = states('sensor.illuminance_max_level') | int(1) %}
        {% set targetValue = iif(maxValuePerDay <= 0, 1, maxValuePerDay) %}
        {% set illuminanceValue = states('sensor.illuminance_level') | int(0) %}
        {% set sensorValue = iif(illuminanceValue > targetValue, targetValue, illuminanceValue) %}
        {{ (sensorValue / targetValue) * 100 }}
      brightness: >
        {% set minValue = 25 %}
        {% set maxValue = 100 %}
        {% set isNightTime = is_state('binary_sensor.date_time_night', 'on') %}
        {% set isMorningTime = is_state('binary_sensor.date_time_morning', 'on') %}
        {% set sensorValue = state_attr('sensor.parameters_light', 'persent') | int(0) %}
        {% set percentValue = 100 - sensorValue %}
        {% set deltaValue = (maxValue - minValue) / 100 * percentValue %}
        {% set dayBrightness = (deltaValue + minValue) | round %}
        {{ iif(isNightTime or isMorningTime, minValue, dayBrightness) }}
      temperature: >
        {% set minValue = 175 %}
        {% set maxValue = 333 %}
        {% set sensorValue = state_attr('sensor.parameters_light', 'persent') | int(0) %}
        {% set percentValue = 100 - sensorValue %}
        {% set deltaValue = (maxValue - minValue) / 100 * percentValue %}
        {{ (deltaValue + minValue) | round }}
      saturation: >
        {% set minValue = 95 %}
        {% set maxValue = 100 %}
        {% set percentValue = state_attr('sensor.parameters_light', 'persent') | int(0) %}
        {% set deltaValue = (maxValue - minValue) / 100 * percentValue %}
        {{ (deltaValue + minValue) | round }}

  - name: 'parameters_top_light_list'
    icon: 'mdi:lightbulb-group'
    state: >
      {% set domain = states.light | list %}
      {% set lights = [] %}
      {% if domain | length > 0 %}
        {% set lights = domain | selectattr("state", "eq" ,"on") %}
        {% set lights = lights | selectattr("name", "search" ,"top_light") %}
        {% set lights = lights | rejectattr("name", "search" ,"_group") %}
        {% set lights = lights | map(attribute="entity_id") %}
      {% endif %}
      {{ lights | list }}

- binary_sensor:
  - name: 'parameters_top_light_permission'
    icon: 'mdi:lightbulb-group'
    state: >
      {% set domain = states.light | list %}
      {% set lights = [] %}
      {% if domain | length > 0 %}
        {% set lights = domain | selectattr("state", "eq" ,"on") %}
        {% set lights = lights | selectattr("name", "search" ,"top_light") %}
        {% set lights = lights | rejectattr("name", "search" ,"_group") %}
        {% set lights = lights | map(attribute="entity_id") %}
      {% endif %}
      {{ lights | list | count > 0 }}