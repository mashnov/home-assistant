## TOP LIGHT 
- sensor:
  - name: 'top_light_enabled_list'
    icon: 'mdi:lightbulb-group'
    state: >
      {% set domain = states.light | list %}
      {% set lights = [] %}
      {% if domain | length > 0 %}
        {% set lights = domain | selectattr("state", "eq" ,"on") %}
        {% set lights = lights | selectattr("name", "search" ,"top_light") %}
        {% set lights = lights | rejectattr("name", "search" ,"_group") %}
        {% set lights = lights | map(attribute="entity_id") %}
      {% endif %}
      {{ lights | list }}

  - name: 'top_light_enabled_count'
    icon: 'mdi:lightbulb-group'
    state: >
      {% set domain = states.light | list %}
      {% set lights = [] %}
      {% if domain | length > 0 %}
        {% set lights = domain | selectattr("state", "eq" ,"on") %}
        {% set lights = lights | selectattr("name", "search" ,"top_light") %}
        {% set lights = lights | rejectattr("name", "search" ,"_group") %}
        {% set lights = lights | map(attribute="entity_id") %}
      {% endif %}
      {{ lights | list | count }}

- binary_sensor:
## TOP LIGHT KITCHEN ON SENSORS
  - name: 'top_light_kitchen_group_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_kitchen_group', 'on') }}"
    icon: 'mdi:light-recessed'

  - name: 'top_light_kitchen_1_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_kitchen_1', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_kitchen_1', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_kitchen_2_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_kitchen_2', 'on') }}" 
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_kitchen_2', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_kitchen_3_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_kitchen_3', 'on') }}" 
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_kitchen_3', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_kitchen_4_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_kitchen_4', 'on') }}" 
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_kitchen_4', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_kitchen_5_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_kitchen_5', 'on') }}" 
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_kitchen_5', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

## TOP LIGHT BATH ON SENSORS
  - name: 'top_light_bath_on'
    device_class: 'plug'
    state: "{{ is_state('binary_sensor.switch_bath_on', 'on') }}" 
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_bath_on', 'on') %}
      {{ iif(isEnable, 'mdi:light-switch', 'mdi:light-switch-off', 'mdi:help-circle') }}

## TOP LIGHT TOILET ON SENSORS
  - name: 'top_light_toilet_on'
    device_class: 'plug'
    state: "{{ is_state('binary_sensor.switch_toilet_on', 'on') }}" 
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_toilet_on', 'on') %}
      {{ iif(isEnable, 'mdi:light-switch', 'mdi:light-switch-off', 'mdi:help-circle') }}

## TOP LIGHT HALL ON SENSORS
  - name: 'top_light_hall_group_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_hall_group', 'on') }}"
    icon: 'mdi:light-recessed'

  - name: 'top_light_hall_1_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_hall_1', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_hall_1', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_hall_2_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_hall_2', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_hall_2', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_hall_3_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_hall_3', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_hall_3', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_hall_4_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_hall_4', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_hall_4', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_hall_5_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_hall_5', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_hall_5', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_hall_6_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_hall_6', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_hall_6', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

## TOP LIGHT BEDROOM ON SENSORS
  - name: 'top_light_bedroom_group_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_bedroom_group', 'on') }}"
    icon: 'mdi:light-recessed'

  - name: 'top_light_bedroom_1_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_bedroom_1', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_bedroom_1', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_bedroom_2_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_bedroom_2', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_bedroom_2', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_bedroom_3_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_bedroom_3', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_bedroom_3', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_bedroom_4_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_bedroom_4', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_bedroom_4', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_bedroom_5_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_bedroom_5', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_bedroom_5', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_bedroom_6_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_bedroom_6', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_bedroom_6', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

## TOP LIGHT LIVING ON SENSORS
  - name: 'top_light_living_group_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_living_group', 'on') }}"
    icon: 'mdi:light-recessed'

  - name: 'top_light_living_1_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_living_1', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_living_1', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_living_2_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_living_2', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_living_2', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_living_3_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_living_3', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_living_3', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_living_4_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_living_4', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_living_4', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_living_5_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_living_5', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_living_5', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

  - name: 'top_light_living_6_on'
    device_class: 'plug'
    state: "{{ is_state('light.top_light_living_6', 'on') }}"
    icon: >
      {% set isEnable = is_state('binary_sensor.top_light_living_6', 'on') %}
      {{ iif(isEnable, 'mdi:lightbulb-variant-outline', 'mdi:lightbulb-variant-outline', 'mdi:help-circle') }}

## TOP LIGHT PERMISSION
  - name: 'top_light_kitchen_permission'
    device_class: 'lock'
    icon: 'mdi:check-all'
    state: >
      {% set isButtonOn = is_state('binary_sensor.button_kitchen_right_on', 'on') %}
      {% set isOccupancy = is_state('binary_sensor.motion_kitchen_boolean', 'on') %}
      {% set isIlluminanceLow = is_state('binary_sensor.illuminance_kitchen_top_light_boolean', 'on') %}
      {% set ignoreIlluminance = is_state('input_boolean.top_light_kitchen_ignore_illuminance', 'on') %}
      {% set illuminancePermission = isIlluminanceLow or ignoreIlluminance %}
      {% set isNightMode = is_state('binary_sensor.night_mode_hall_boolean', 'on') %}
      {% set ignoreNightMode = is_state('input_boolean.top_light_kitchen_ignore_night_mode', 'on') %}
      {% set nightModePermission = not(isNightMode) or ignoreNightMode %}
      {{ isButtonOn or (nightModePermission and isOccupancy and illuminancePermission) }}

  - name: 'top_light_bath_permission'
    device_class: 'lock'
    icon: 'mdi:check-all'
    state: >
      {% set isButtonOn = is_state('binary_sensor.button_bath_on', 'on') %}
      {% set isOccupancy = is_state('binary_sensor.motion_bath_boolean', 'on') %}
      {% set isNightMode = is_state('binary_sensor.night_mode_hall_boolean', 'on') %}
      {% set ignoreNightMode = is_state('input_boolean.top_light_bath_ignore_night_mode', 'on') %}
      {% set nightModePermission = not(isNightMode) or ignoreNightMode %}
      {{ isButtonOn or (nightModePermission and isOccupancy) }}

  - name: 'top_light_toilet_permission'
    device_class: 'lock'
    icon: 'mdi:check-all'
    state: >
      {% set isButtonOn = is_state('binary_sensor.button_toilet_on', 'on') %}
      {% set isOccupancy = is_state('binary_sensor.occupancy_toilet_boolean', 'on') %}
      {% set isNightMode = is_state('binary_sensor.night_mode_hall_boolean', 'on') %}
      {% set ignoreNightMode = is_state('input_boolean.top_light_toilet_ignore_night_mode', 'on') %}
      {% set nightModePermission = not(isNightMode) or ignoreNightMode %}
      {{ isButtonOn or (nightModePermission and isOccupancy) }}

  - name: 'top_light_hall_permission'
    device_class: 'lock'
    icon: 'mdi:check-all'
    state: >
      {% set isButtonOn = is_state('binary_sensor.button_hall_on', 'on') %}
      {% set isOccupancy = is_state('binary_sensor.motion_hall_boolean', 'on') %}
      {% set isIlluminanceLow = is_state('binary_sensor.illuminance_hall_top_light_boolean', 'on') %}
      {% set ignoreIlluminance = is_state('input_boolean.top_light_hall_ignore_illuminance', 'on') %}
      {% set illuminancePermission = isIlluminanceLow or ignoreIlluminance %}
      {% set isNightMode = is_state('binary_sensor.night_mode_hall_boolean', 'on') %}
      {% set ignoreNightMode = is_state('input_boolean.top_light_hall_ignore_night_mode', 'on') %}
      {% set nightModePermission = not(isNightMode) or ignoreNightMode %}
      {{ isButtonOn or (nightModePermission and isOccupancy and illuminancePermission) }}

  - name: 'top_light_bedroom_permission'
    device_class: 'lock'
    icon: 'mdi:check-all'
    state: "{{ is_state('binary_sensor.button_bedroom_right_on', 'on') }}"

  - name: 'top_light_living_permission'
    device_class: 'lock'
    icon: 'mdi:check-all'
    state: "{{ is_state('binary_sensor.button_living_right_on', 'on') }}"


