- binary_sensor:
  - name: 'empty'
    device_class: 'problem'
    state: >
      {% set hallValue = state_attr('binary_sensor.empty', 'hall_delayed') %}
      {% set bedroomValue = state_attr('binary_sensor.empty', 'bedroom_delayed') %}
      {% set livingValue = state_attr('binary_sensor.empty', 'living_delayed') %}
      {{ hallValue or bedroomValue or livingValue }}
    icon: >
      {% set isLowIcon = is_state('binary_sensor.empty', 'on') and 'mdi:water-opacity' %}
      {% set isNormalIcon = is_state('binary_sensor.empty', 'off') and 'mdi:water' %}
      {% set defaultIcon = 'mdi:help-circle'%}
      {{ isLowIcon or isNormalIcon or defaultIcon }}
    attributes:
      hall: >
        {% set humidifierIsOn = state_attr('binary_sensor.relay', 'hall_2') %}
        {% set backlightIsOn = state_attr('binary_sensor.relay', 'hall_1') %}
        {% set humidifierMinPower = 1 %}
        {% set backlightMinPower = states('input_number.pw_offset_hall') | int(0) %}
        {% set relayMinPower = backlightMinPower + humidifierMinPower %}
        {% set sensorValue = state_attr('sensor.power', 'hall') | int(0) %}
        {% set expectedValue = iif(backlightIsOn, relayMinPower, humidifierMinPower) %}
        {{ humidifierIsOn and (sensorValue <= expectedValue) }}
      hall_delayed: "{{ is_state('input_boolean.e_hall', 'on') }}"
      bedroom: >
        {% set humidifierIsOn = state_attr('binary_sensor.relay', 'bedroom_2') %}
        {% set backlightIsOn = state_attr('binary_sensor.relay', 'bedroom_1') %}
        {% set humidifierMinPower = 1 %}
        {% set backlightMinPower = states('input_number.pw_offset_bedroom') | int(0) %}
        {% set relayMinPower = backlightMinPower + humidifierMinPower %}
        {% set sensorValue = state_attr('sensor.power', 'bedroom') | int(0) %}
        {% set expectedValue = iif(backlightIsOn, relayMinPower, humidifierMinPower) %}
        {{ humidifierIsOn and (sensorValue <= expectedValue) }}
      bedroom_delayed: "{{ is_state('input_boolean.e_bedroom', 'on') }}"
      living: >
        {% set humidifierIsOn = state_attr('binary_sensor.relay', 'living_1') %}
        {% set backlightIsOn = state_attr('binary_sensor.relay', 'living_2') %}
        {% set humidifierMinPower = 1 %}
        {% set backlightMinPower = states('input_number.pw_offset_living') | int(0) %}
        {% set relayMinPower = backlightMinPower + humidifierMinPower %}
        {% set sensorValue = state_attr('sensor.power', 'living') | int(0) %}
        {% set expectedValue = iif(backlightIsOn, relayMinPower, humidifierMinPower) %}
        {{ humidifierIsOn and (sensorValue <= expectedValue) }}
      living_delayed: "{{ is_state('input_boolean.e_living', 'on') }}"
